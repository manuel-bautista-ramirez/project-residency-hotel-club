<style>
  /* Animaci√≥n para precio modificado */
  .precio-especial {
    background-color: #fffbeb !important;
    border: 2px solid #fbbf24 !important;
    transform: translateY(-4px);
    box-shadow: 0 12px 20px -5px rgba(251, 191, 36, 0.3);
  }

  .card-area {
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
  }

  .input-readonly {
    background: transparent !important;
    border: none !important;
    outline: none !important;
    cursor: default;
    pointer-events: none;
  }

  /* Ajuste para que los n√∫meros tengan espacio */
  .price-input {
    letter-spacing: -0.02em;
    min-width: 100px;
  }

  .btn-select-canchas { background: linear-gradient(135deg, #2563eb, #1d4ed8); }
  .btn-select-alberca { background: linear-gradient(135deg, #0d9488, #0f766e); }
  .btn-select-gym { background: linear-gradient(135deg, #d97706, #b45309); }
</style>

<main class="pt-28 max-w-screen-xl mx-auto px-4 pb-20">
  <section class="bg-white rounded-[2.5rem] shadow-2xl p-8 md:p-12 border border-gray-50">
    
    <header class="text-center mb-12">
      <span class="bg-indigo-50 text-indigo-600 px-4 py-1.5 rounded-full text-xs font-black uppercase tracking-widest">Recepci√≥n Hotel Club</span>
      <h1 class="text-4xl font-black text-gray-900 mt-4 tracking-tight">Registro de Visitantes</h1>
      <p class="text-gray-400 mt-2 font-medium">Capture los datos del cliente y seleccione el √°rea de acceso.</p>
    </header>

    <form id="entryForm" action="/api/entries" method="POST" class="space-y-8">
      
      <div class="bg-gray-50 p-8 rounded-[2rem] border border-gray-100">
        <h2 class="text-sm font-black text-gray-400 uppercase tracking-widest mb-6 flex items-center gap-2">
          <span class="w-8 h-8 rounded-full bg-indigo-600 text-white flex items-center justify-center text-[10px]">01</span>
          Informaci√≥n del Cliente
        </h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
          <div class="relative">
            <label for="first_name" class="block text-xs font-bold text-gray-500 uppercase ml-1 mb-2">Nombre(s)</label>
            <input type="text" id="first_name" name="first_name" required placeholder="Ej. Juan"
                   class="w-full rounded-2xl border-gray-200 bg-white px-5 py-3.5 focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 transition-all outline-none text-gray-700 font-medium shadow-sm">
          </div>
          <div class="relative">
            <label for="last_name" class="block text-xs font-bold text-gray-500 uppercase ml-1 mb-2">Apellido(s)</label>
            <input type="text" id="last_name" name="last_name" required placeholder="Ej. P√©rez"
                   class="w-full rounded-2xl border-gray-200 bg-white px-5 py-3.5 focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 transition-all outline-none text-gray-700 font-medium shadow-sm">
          </div>
        </div>

        <div class="mt-8">
          <label class="block text-xs font-bold text-gray-500 uppercase ml-1 mb-4">M√©todo de Pago Preferido</label>
          <div class="flex gap-4">
            <label class="flex-1 relative cursor-pointer group">
              <input type="radio" name="payment_method" value="Efectivo" checked class="peer hidden">
              <div class="bg-white border-2 border-gray-100 p-4 rounded-2xl text-center font-bold text-gray-500 peer-checked:border-indigo-600 peer-checked:text-indigo-600 peer-checked:bg-indigo-50 transition-all group-hover:border-indigo-200 shadow-sm">
                üíµ Efectivo
              </div>
            </label>
            <label class="flex-1 relative cursor-pointer group">
              <input type="radio" name="payment_method" value="Transferencia" class="peer hidden">
              <div class="bg-white border-2 border-gray-100 p-4 rounded-2xl text-center font-bold text-gray-500 peer-checked:border-indigo-600 peer-checked:text-indigo-600 peer-checked:bg-indigo-50 transition-all group-hover:border-indigo-200 shadow-sm">
                üì± Transferencia
              </div>
            </label>
          </div>
        </div>
      </div>

      <div class="bg-gray-50 p-8 rounded-[2rem] border border-gray-100">
        <h2 class="text-sm font-black text-gray-400 uppercase tracking-widest mb-6 flex items-center gap-2">
          <span class="w-8 h-8 rounded-full bg-indigo-600 text-white flex items-center justify-center text-[10px]">02</span>
          Seleccione √Årea y Tarifa
        </h2>
        
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
          <div class="card-area rounded-[2rem] p-6 bg-white border border-gray-200 shadow-sm flex flex-col justify-between" onclick="focusPrice('price_canchas')">
            <div class="flex justify-between items-start mb-4">
              <div class="p-3 bg-blue-50 text-blue-600 rounded-2xl text-2xl">üéæ</div>
              <span class="text-[9px] font-black bg-blue-100 text-blue-700 px-2 py-1 rounded-lg uppercase">Canchas</span>
            </div>
            <div class="flex items-baseline gap-1 mb-6">
              <span class="text-xl font-bold text-gray-400">$</span>
              <input type="number" id="price_canchas" value="{{prices.price_canchas}}" data-original="{{prices.price_canchas}}"
                     class="price-input w-32 text-4xl font-black text-indigo-600 bg-transparent outline-none {{#unless (eq user.role 'Administrador')}}input-readonly{{/unless}}">
            </div>
            <button type="button" onclick="selectArea('Canchas', 'price_canchas', this)"
                    class="btn-select-canchas w-full text-white py-4 rounded-2xl font-bold shadow-lg shadow-blue-200 hover:scale-[1.02] active:scale-95 transition-all uppercase text-[10px] tracking-widest">
              Seleccionar
            </button>
          </div>

          <div class="card-area rounded-[2rem] p-6 bg-white border border-gray-200 shadow-sm flex flex-col justify-between" onclick="focusPrice('price_alberca')">
            <div class="flex justify-between items-start mb-4">
              <div class="p-3 bg-teal-50 text-teal-600 rounded-2xl text-2xl">üèä</div>
              <span class="text-[9px] font-black bg-teal-100 text-teal-700 px-2 py-1 rounded-lg uppercase">Alberca</span>
            </div>
            <div class="flex items-baseline gap-1 mb-6">
              <span class="text-xl font-bold text-gray-400">$</span>
              <input type="number" id="price_alberca" value="{{prices.price_alberca}}" data-original="{{prices.price_alberca}}"
                     class="price-input w-32 text-4xl font-black text-teal-600 bg-transparent outline-none {{#unless (eq user.role 'Administrador')}}input-readonly{{/unless}}">
            </div>
            <button type="button" onclick="selectArea('Alberca', 'price_alberca', this)"
                    class="btn-select-alberca w-full text-white py-4 rounded-2xl font-bold shadow-lg shadow-teal-200 hover:scale-[1.02] active:scale-95 transition-all uppercase text-[10px] tracking-widest">
              Seleccionar
            </button>
          </div>

          <div class="card-area rounded-[2rem] p-6 bg-white border border-gray-200 shadow-sm flex flex-col justify-between" onclick="focusPrice('price_gym')">
            <div class="flex justify-between items-start mb-4">
              <div class="p-3 bg-amber-50 text-amber-600 rounded-2xl text-2xl">üèãÔ∏è</div>
              <span class="text-[9px] font-black bg-amber-100 text-amber-700 px-2 py-1 rounded-lg uppercase">Gimnasio</span>
            </div>
            <div class="flex items-baseline gap-1 mb-6">
              <span class="text-xl font-bold text-gray-400">$</span>
              <input type="number" id="price_gym" value="{{prices.price_gym}}" data-original="{{prices.price_gym}}"
                     class="price-input w-32 text-4xl font-black text-amber-600 bg-transparent outline-none {{#unless (eq user.role 'Administrador')}}input-readonly{{/unless}}">
            </div>
            <button type="button" onclick="selectArea('Gimnasio', 'price_gym', this)"
                    class="btn-select-gym w-full text-white py-4 rounded-2xl font-bold shadow-lg shadow-amber-200 hover:scale-[1.02] active:scale-95 transition-all uppercase text-[10px] tracking-widest">
              Seleccionar
            </button>
          </div>
        </div>
      </div>

      <input type="hidden" id="selected_area" name="area">
      <input type="hidden" id="selected_cost" name="cost">
    </form>

    <div class="mt-16 flex flex-wrap justify-center gap-10 border-t border-gray-100 pt-10">
      <a href="/entries/list" class="flex items-center gap-2 text-gray-400 font-bold hover:text-indigo-600 transition group">
        <span class="p-2 bg-gray-50 group-hover:bg-indigo-50 rounded-lg transition">üìã</span> Ver Registros
      </a>
      
      {{#if (eq user.role "Administrador")}}
        <a href="/entries/reports" class="flex items-center gap-2 text-gray-400 font-bold hover:text-green-600 transition group">
          <span class="p-2 bg-gray-50 group-hover:bg-green-50 rounded-lg transition">üí∞</span> Reportes de Ingresos
        </a>
      {{else}}
        <button onclick="restrictedAccess()" class="flex items-center gap-2 text-gray-300 font-bold hover:text-red-400 transition group">
          <span class="p-2 bg-gray-50 group-hover:bg-red-50 rounded-lg transition">üí∞</span> Reportes de Ingresos
        </button>
      {{/if}}
    </div>

    {{#if (eq user.role "Administrador")}}
    <div class="mt-20 p-8 bg-slate-900 rounded-[2.5rem] text-white shadow-2xl relative overflow-hidden">
      <div class="absolute top-0 right-0 p-8 opacity-10 text-8xl">‚öôÔ∏è</div>
      <div class="relative z-10">
        <div class="flex items-center gap-4 mb-8">
          <div class="w-12 h-12 bg-white/10 rounded-2xl flex items-center justify-center text-xl">üõ†Ô∏è</div>
          <div>
            <h2 class="text-xl font-black uppercase tracking-tight">Configuraci√≥n de Tarifas Base</h2>
            <p class="text-slate-400 text-xs">Precios predeterminados en la base de datos.</p>
          </div>
        </div>
        <form action="/api/entries/update-settings" method="POST" class="grid grid-cols-1 md:grid-cols-4 gap-6 items-end">
          <div>
            <label class="block text-[10px] font-black uppercase tracking-widest mb-2 text-slate-500">Canchas</label>
            <input type="number" name="price_canchas" value="{{prices.price_canchas}}" required class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 outline-none focus:bg-white/10 transition">
          </div>
          <div>
            <label class="block text-[10px] font-black uppercase tracking-widest mb-2 text-slate-500">Alberca</label>
            <input type="number" name="price_alberca" value="{{prices.price_alberca}}" required class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 outline-none focus:bg-white/10 transition">
          </div>
          <div>
            <label class="block text-[10px] font-black uppercase tracking-widest mb-2 text-slate-500">Gimnasio</label>
            <input type="number" name="price_gym" value="{{prices.price_gym}}" required class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 outline-none focus:bg-white/10 transition">
          </div>
          <button type="submit" class="bg-indigo-600 text-white py-3.5 rounded-xl font-black text-xs uppercase tracking-widest hover:bg-indigo-500 transition shadow-xl">
            Actualizar Base
          </button>
        </form>
      </div>
    </div>
    {{/if}}

  </section>
</main>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
  let lastSelectedCard = null;
  const clubColors = { primary: '#4f46e5', danger: '#ef4444', success: '#16a34a' };

  // Resaltar si el Admin cambia el precio manualmente
  document.querySelectorAll('.price-input').forEach(input => {
    input.addEventListener('input', (e) => {
      const card = e.target.closest('.card-area');
      const original = e.target.getAttribute('data-original');
      card.classList.toggle('precio-especial', e.target.value !== original);
    });
  });

  function restrictedAccess() {
    Swal.fire({
      title: 'Acceso Denegado',
      text: 'Solo el administrador tiene permisos para ver los reportes de ingresos.',
      icon: 'error',
      confirmButtonColor: clubColors.danger,
      borderRadius: '2rem'
    });
  }

  function selectArea(areaName, inputId, btn) {
    const precioActual = document.getElementById(inputId).value;
    const firstName = document.getElementById('first_name').value.trim();
    const lastName = document.getElementById('last_name').value.trim();
    const paymentMethod = document.querySelector('input[name="payment_method"]:checked')?.value;

    if (!firstName || !lastName) {
      Swal.fire({ title: 'Atenci√≥n', text: 'Complete nombre y apellido.', icon: 'warning', confirmButtonColor: clubColors.primary, borderRadius: '2rem' });
      return;
    }

    document.getElementById('selected_area').value = areaName;
    document.getElementById('selected_cost').value = precioActual;

    if (lastSelectedCard) lastSelectedCard.classList.remove('ring-4', 'ring-indigo-500', 'scale-[1.03]');
    const card = btn.closest('.card-area');
    card.classList.add('ring-4', 'ring-indigo-500', 'scale-[1.03]');
    lastSelectedCard = card;

    Swal.fire({
      title: '<span style="color:#1e1b4b">Confirmar Registro</span>',
      html: `
        <div style="text-align:left; background:#f8fafc; padding:20px; border-radius:1.5rem; border:1px solid #e2e8f0;">
          <p style="margin-bottom:8px;"><strong style="color:#64748b">Visitante:</strong> <span style="color:#1e293b; font-weight:800">${firstName} ${lastName}</span></p>
          <p style="margin-bottom:8px;"><strong style="color:#64748b">√Årea:</strong> <span style="color:#4f46e5; font-weight:800">${areaName}</span></p>
          <p style="margin-bottom:8px;"><strong style="color:#64748b">Costo:</strong> <span style="color:#10b981; font-weight:800">$${precioActual}.00</span></p>
          <p><strong style="color:#64748b">M√©todo:</strong> <span style="color:#1e293b; font-weight:800">${paymentMethod}</span></p>
        </div>`,
      icon: 'question',
      showCancelButton: true,
      confirmButtonText: 'Confirmar y Registrar',
      cancelButtonText: 'Cancelar',
      confirmButtonColor: clubColors.success,
      borderRadius: '2.5rem'
    }).then(result => {
      if (result.isConfirmed) document.getElementById('entryForm').submit();
    });
  }

  function focusPrice(id) {
    const input = document.getElementById(id);
    if (!input.readOnly) input.focus();
  }
</script>