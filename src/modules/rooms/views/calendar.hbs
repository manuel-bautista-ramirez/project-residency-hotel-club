<!-- FullCalendar local -->
<script src="/js/ModuleRooms/js/lib/fullcalendar@6.1.8/index.global.min.js"></script>

<style>
/* ===============================
   CALENDARIO H√çBRIDO
   =============================== */
.fc {
  font-family: 'Segoe UI', system-ui, sans-serif;
  width:100%;
}

/* Toolbar */
.fc .fc-toolbar {
  background: linear-gradient(135deg,#667eea,#764ba2);
  color: white;
  margin: 0;
  border-radius: 5px;
  padding: 0.4rem 0.2rem;
}
.fc .fc-toolbar-title { font-size:1.05rem; font-weight:600; color:white; }
.fc .fc-button {
  background: rgba(255,255,255,0.18);
  border:1px solid rgba(255,255,255,0.28);
  color:white; font-weight:600;
  padding:0.25rem 0.4rem; border-radius:0.5rem; font-size:0.65rem;
}
.fc .fc-button:hover { background: rgba(255,255,255,0.28); }

/* Column headers */
.fc .fc-col-header-cell {
  background:#f8fafc; border:1px solid #e2e8f0; padding:0px; height: 22px;
}
.fc .fc-col-header-cell-cushion {
  color:#374151; font-weight:600; font-size:0.6rem;
}

/* D√≠a actual */
.fc .fc-day-today { background-color:#eff6ff!important; }
.fc .fc-day-today .fc-daygrid-day-number { color:#2563eb; font-weight:800; font-size:0.75rem; }

/* ===============================
   CELDAS - H√çBRIDAS
   =============================== */
.fc .fc-daygrid-day,
.fc .fc-daygrid-day > .fc-daygrid-day-frame {
  min-height: 100px !important;  /* altura m√≠nima */
  padding: 4px 6px !important;
  box-sizing: border-box;
  overflow: visible;              /* permite expandirse si hay muchos eventos */
}

/* N√∫meros de d√≠a */
.fc .fc-daygrid-day-number {
  font-size: 0.8rem !important;
  padding: 2px 3px !important;
  font-weight:600;
  line-height: 1.2;
}

/* Eventos dentro de la celda */
.fc-event {
  border-radius:4px!important;
  font-size:0.65rem!important;
  font-weight:600!important;
  line-height:1.2!important;
  padding:2px 4px!important;
  white-space: nowrap !important;
  text-overflow: ellipsis;
  overflow: hidden;
}
.fc-event-renta { background:#10b981!important; color:#fff!important; }
.fc-event-reservacion { background:#3b82f6!important; color:#fff!important; }

/* Responsive */
@media (max-width: 768px) {
  .fc .fc-toolbar-title { font-size:0.9rem; }
  .fc .fc-button { font-size:0.5rem; padding:0.15rem 0.3rem; }
  .fc .fc-daygrid-day,
  .fc .fc-daygrid-day > .fc-daygrid-day-frame {
    min-height: 80px !important;
  }
  .fc .fc-daygrid-day-number { font-size:0.65rem!important; padding:1px 2px !important; }
  .fc-event { font-size:0.55rem!important; padding:1px 2px!important; }
}
</style>

<div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 pt-20 sm:p-4">
  <div class="max-w-7xl mx-auto overflow-x-hidden pb-16">

    <div class="mb-4 sm:mb-6 text-center px-2 pt-12">
      <h1 class="text-2xl font-bold text-blue-900">Calendario</h1>
      {{>buttons}}
    </div>

    <!-- Calendario -->
    <div class="bg-white rounded-xl shadow-lg overflow-hidden mx-2 p-3">
      <div id="calendar" class="w-full"></div>
    </div>
  </div>
</div>

<!-- Modal de eventos -->
<div id="viewEventModal" class="fixed inset-0 z-50 hidden backdrop-blur-sm bg-black/50">
  <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-md p-4">
    <div class="bg-white rounded-2xl shadow-2xl w-full overflow-hidden">

      <!-- Header -->
      <div id="viewEventHeader" class="px-6 py-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white flex justify-between items-center">
        <div class="flex items-center gap-3">
          <div id="viewEventIcon" class="rounded-xl p-3 bg-blue-500">
            <!-- icono opcional -->
          </div>
          <div>
            <h3 id="viewEventTitle" class="text-lg font-bold text-white"></h3>
            <span id="viewEventBadge" class="inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold mt-1 bg-blue-100 text-blue-800"></span>
          </div>
        </div>
        <button onclick="closeViewEventModal()" class="text-white/80 hover:text-white transition">X</button>
      </div>

      <!-- Contenido -->
      <div class="px-6 py-4 space-y-4">
        <div class="flex items-center gap-4 p-3 bg-blue-50 rounded-xl">
          <div>
            <p class="text-xs font-semibold text-blue-600 uppercase">Fechas</p>
            <p id="viewEventDates" class="text-base font-bold text-gray-900"></p>
          </div>
        </div>
        <div id="viewEventEmailContainer" class="flex items-center gap-4 p-3 bg-purple-50 rounded-xl">
          <div>
            <p class="text-xs font-semibold text-purple-600 uppercase">Correo</p>
            <p id="viewEventEmail" class="text-sm font-medium text-gray-900 break-all"></p>
          </div>
        </div>
        <div id="viewEventPhoneContainer" class="flex items-center gap-4 p-3 bg-green-50 rounded-xl">
          <div>
            <p class="text-xs font-semibold text-green-600 uppercase">Tel√©fono</p>
            <p id="viewEventPhone" class="text-sm font-medium text-gray-900"></p>
          </div>
        </div>
      </div>

      <div class="px-6 py-4 bg-gray-50 border-t">
        <button onclick="closeViewEventModal()" class="w-full px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-xl">Cerrar</button>
      </div>

    </div>
  </div>
</div>


<script>
document.addEventListener('DOMContentLoaded', function () {
  const calendarEl = document.getElementById('calendar');
  if (!calendarEl) return console.error('No se encontr√≥ #calendar');

  // Funciones del modal
  window.openViewEventModal = function(event) {
    const modal = document.getElementById('viewEventModal');
    const header = document.getElementById('viewEventHeader');
    const icon = document.getElementById('viewEventIcon');
    const badge = document.getElementById('viewEventBadge');
    const props = event.extendedProps || {};
    const isRenta = props.tipo === 'renta';

    if (isRenta) {
      header.className = 'px-6 py-4 bg-gradient-to-r from-emerald-600 to-emerald-700 text-white';
      icon.className = 'rounded-xl p-3 bg-emerald-500';
      badge.className = 'inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold mt-1 bg-emerald-100 text-emerald-800';
      badge.textContent = 'üè† Renta activa';
    } else {
      header.className = 'px-6 py-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white';
      icon.className = 'rounded-xl p-3 bg-blue-500';
      badge.className = 'inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold mt-1 bg-blue-100 text-blue-800';
      badge.textContent = 'üìã Reservaci√≥n';
    }

    document.getElementById("viewEventTitle").textContent = event.title || '';
    const s = new Date(event.start);
    const e = event.end ? new Date(event.end) : null;
    document.getElementById("viewEventDates").textContent =
      `Del ${s.toLocaleDateString('es-MX')} al ${e?.toLocaleDateString('es-MX')}`;

    document.getElementById("viewEventEmail").textContent = props.correo || "Sin correo";
    document.getElementById("viewEventPhone").textContent = props.telefono || "Sin tel√©fono";
    document.getElementById("viewEventEmailContainer").classList.toggle("hidden", !props.correo);
    document.getElementById("viewEventPhoneContainer").classList.toggle("hidden", !props.telefono);

    modal.classList.remove("hidden");
    document.body.style.overflow = "hidden";
  };

  window.closeViewEventModal = function () {
    document.getElementById('viewEventModal').classList.add('hidden');
    document.body.style.overflow = '';
  };

  document.addEventListener("keydown", e => {
    if (e.key === "Escape") closeViewEventModal();
  });

  // FULLCALENDAR
  const calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth',
    locale: 'es',
    firstDay: 1,
    fixedWeekCount: false,
    dayMaxEvents: false,   // mostrar todos los eventos sin cortar
    eventDisplay: 'block',
    displayEventTime: false,
    aspectRatio: 2.5,
    contentHeight: 'auto',
    headerToolbar: { left: 'prev,next', center: 'title', right: 'today' },
    buttonText: { today: 'Hoy' },
    eventClick(info) { openViewEventModal(info.event); },
    eventDidMount(info) {
      const el = info.el;
      if (info.event.extendedProps.tipo === "renta") el.classList.add("fc-event-renta");
      else el.classList.add("fc-event-reservacion");
      el.style.cursor = "pointer";
      el.title = `${info.event.title}`;
    },
    events(fetchInfo, successCallback) {
      fetch('/rooms/calendario/eventos')
        .then(res => { if(!res.ok) throw new Error("API error"); return res.json(); })
        .then(data => successCallback(data))
        .catch(err => { console.error("Error cargando eventos:", err); successCallback([]); });
    }
  });

  calendar.render();
});
</script>
