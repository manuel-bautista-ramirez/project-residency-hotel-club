<style>
  .active-period {
    background-color: #3B82F6;
    color: white;
  }

  #calendar {
    transition: all 0.3s ease;
  }

  .report-type-option.active-report {
    border-color: #3B82F6;
    background-color: #EBF8FF;
  }

  .period-option.active {
    border-color: #3B82F6;
    background-color: #EBF8FF;
  }

  /* Animaciones para botones */
  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }

  @keyframes pulse {

    0%,
    100% {
      transform: scale(1);
    }

    50% {
      transform: scale(1.05);
    }
  }

  @keyframes shake {

    0%,
    100% {
      transform: translateX(0);
    }

    25% {
      transform: translateX(-5px);
    }

    75% {
      transform: translateX(5px);
    }
  }

  .btn-loading {
    position: relative;
    pointer-events: none;
    opacity: 0.8;
  }

  .btn-spinner {
    display: none;
    width: 20px;
    height: 20px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: #fff;
    animation: spin 0.8s linear infinite;
    position: absolute;
    left: 50%;
    top: 50%;
    margin-left: -10px;
    margin-top: -10px;
  }

  .btn-loading .btn-spinner {
    display: block;
  }

  .btn-loading .btn-text {
    opacity: 0;
  }

  .btn-loading::after {
    content: var(--btn-loading-text, "Cargando...");
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 0.875rem;
    padding-left: 25px;
    /* Espacio para el spinner */
  }

  /* Ajuste para el spinner cuando hay texto */
  .btn-loading .btn-spinner {
    display: block;
    left: calc(50% - 50px);
    /* Mover a la izquierda del texto */
  }

  .btn-success {
    background-color: #10B981 !important;
    animation: pulse 0.5s ease-in-out;
  }

  .btn-error {
    background-color: #EF4444 !important;
    animation: shake 0.4s ease-in-out;
  }
</style>

<!-- Contenido principal -->
<div class="container mx-auto px-4 mt-20 pb-14">

  <!-- Header -->
  <header class="mb-8 text-center">
    <h1 class="text-2xl md:text-3xl font-extrabold text-blue-900 tracking-tight">Reportes de Habitaciones</h1>
    <p class="text-gray-600 mt-2">Genera reportes de rentas, reservaciones y env칤alos por correo o WhatsApp.</p>
  </header>

  {{>buttons}}

  <div id="notification-area" class="mb-4"></div>

  <div class="bg-white rounded-lg shadow-md p-4 md:p-6">

    <!-- Selector de tipo de reporte -->
    <div class="mb-6">
      <h2 class="text-lg md:text-xl font-semibold text-gray-700 mb-4">Tipo de Reporte</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4">
        <div
          class="report-type-option border-2 border-blue-500 bg-blue-50 rounded-lg p-3 md:p-4 text-center cursor-pointer transition-all hover:shadow-md active-report"
          data-type="rentas">
          <i class="fas fa-bed text-2xl md:text-4xl text-blue-500 mb-2 block"></i>
          <h3 class="font-semibold text-sm md:text-base">Reporte de Rentas</h3>
          <p class="text-xs md:text-sm text-gray-500 mt-1">An치lisis de habitaciones rentadas</p>
        </div>
        <div
          class="report-type-option border-2 border-gray-200 rounded-lg p-3 md:p-4 text-center cursor-pointer transition-all hover:shadow-md"
          data-type="reservaciones">
          <i class="fas fa-calendar-check text-2xl md:text-4xl text-green-500 mb-2 block"></i>
          <h3 class="font-semibold text-sm md:text-base">Reporte de Reservaciones</h3>
          <p class="text-xs md:text-sm text-gray-500 mt-1">An치lisis de reservaciones</p>
        </div>
        <div
          class="report-type-option border-2 border-gray-200 rounded-lg p-3 md:p-4 text-center cursor-pointer transition-all hover:shadow-md sm:col-span-2 lg:col-span-1"
          data-type="consolidado">
          <i class="fas fa-chart-bar text-2xl md:text-4xl text-purple-500 mb-2 block"></i>
          <h3 class="font-semibold text-sm md:text-base">Reporte Consolidado</h3>
          <p class="text-xs md:text-sm text-gray-500 mt-1">Rentas + Reservaciones</p>
        </div>
      </div>
    </div>

    <!-- Selector de Per칤odo -->
    <div class="mb-6">
      <h2 class="text-lg md:text-xl font-semibold text-gray-700 mb-4">Per칤odo del Reporte</h2>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-4">
        <button
          class="period-option border-2 border-blue-500 bg-blue-50 rounded-lg p-3 md:p-4 text-center cursor-pointer transition-all hover:shadow-md active"
          data-period="diario">
          <i class="fas fa-calendar-day text-xl md:text-3xl text-blue-500 mb-2 block"></i>
          <h3 class="font-semibold text-xs md:text-sm">Diario</h3>
        </button>
        <button
          class="period-option border-2 border-gray-200 rounded-lg p-3 md:p-4 text-center cursor-pointer transition-all hover:shadow-md"
          data-period="semanal">
          <i class="fas fa-calendar-week text-xl md:text-3xl text-green-500 mb-2 block"></i>
          <h3 class="font-semibold text-xs md:text-sm">Semanal</h3>
        </button>
        <button
          class="period-option border-2 border-gray-200 rounded-lg p-3 md:p-4 text-center cursor-pointer transition-all hover:shadow-md"
          data-period="quincenal">
          <i class="fas fa-calendar-alt text-xl md:text-3xl text-purple-500 mb-2 block"></i>
          <h3 class="font-semibold text-xs md:text-sm">Quincenal</h3>
        </button>
        <button
          class="period-option border-2 border-gray-200 rounded-lg p-3 md:p-4 text-center cursor-pointer transition-all hover:shadow-md"
          data-period="mensual">
          <i class="fas fa-calendar text-xl md:text-3xl text-orange-500 mb-2 block"></i>
          <h3 class="font-semibold text-xs md:text-sm">Mensual</h3>
        </button>
      </div>
    </div>


    <!-- Filtros y Fechas -->
    <div class="mb-6">
      <h2 class="text-lg md:text-xl font-semibold text-gray-700 mb-4">Filtros y Fechas</h2>

      <!-- Selector de fecha para DIARIO -->
      <div id="selector-diario" class="date-selector mb-4">
        <label class="block text-sm md:text-base text-gray-700 mb-2 font-medium">Selecciona el d칤a:</label>
        <input type="date" id="fecha-diaria"
          class="border border-gray-300 rounded-lg p-2 md:p-3 w-full md:w-64 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
      </div>

      <!-- Selector de semana para SEMANAL -->
      <div id="selector-semanal" class="date-selector hidden mb-4">
        <label class="block text-sm md:text-base text-gray-700 mb-2 font-medium">Selecciona la semana:</label>
        <input type="week" id="fecha-semanal"
          class="border border-gray-300 rounded-lg p-2 md:p-3 w-full md:w-64 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
      </div>

      <!-- Selector de quincena para QUINCENAL -->
      <div id="selector-quincenal" class="date-selector hidden mb-4">
        <label class="block text-sm md:text-base text-gray-700 mb-2 font-medium">Selecciona la quincena:</label>
        <div class="flex flex-col sm:flex-row gap-3 mb-3">
          <div class="flex items-center space-x-2">
            <input type="radio" id="primera-quincena" name="quincena" value="primera" checked
              class="text-blue-600 focus:ring-blue-500">
            <label for="primera-quincena" class="text-sm md:text-base">Primera quincena (1-15)</label>
          </div>
          <div class="flex items-center space-x-2">
            <input type="radio" id="segunda-quincena" name="quincena" value="segunda"
              class="text-blue-600 focus:ring-blue-500">
            <label for="segunda-quincena" class="text-sm md:text-base">Segunda quincena (16-fin)</label>
          </div>
        </div>
        <input type="month" id="fecha-quincenal"
          class="border border-gray-300 rounded-lg p-2 md:p-3 w-full md:w-64 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
      </div>

      <!-- Selector de mes para MENSUAL -->
      <div id="selector-mensual" class="date-selector hidden mb-4">
        <label class="block text-sm md:text-base text-gray-700 mb-2 font-medium">Selecciona el mes:</label>
        <input type="month" id="fecha-mensual"
          class="border border-gray-300 rounded-lg p-2 md:p-3 w-full md:w-64 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
      </div>

      <!-- Botones de Acci칩n -->
      <div class="mt-6 pt-4 border-t border-gray-200">
        <div class="flex flex-col sm:flex-row gap-3 sm:gap-4">
          <button id="generar-reporte-btn"
            class="bg-blue-500 hover:bg-blue-600 text-white px-4 md:px-6 py-2 md:py-3 rounded-lg transition-all duration-300 flex items-center justify-center text-sm md:text-base font-medium relative overflow-hidden">
            <span class="btn-text">
              <i class="fas fa-chart-bar mr-2"></i>Generar Reporte
            </span>
            <div class="btn-spinner"></div>
          </button>
        </div>
      </div>
    </div>

    <!-- Vista previa del reporte -->
    <div class="p-3">
      <div id="reporte-container" class="bg-gray-50 rounded-lg p-4 md:p-7 mt-6 mb-6 ">
        <div class="flex justify-center items-center h-32 md:h-40 border border-dashed border-gray-300 rounded-lg">
          <p class="text-gray-500 text-sm md:text-base text-center">Selecciona un tipo de reporte y genera la vista
            previa
          </p>
        </div>
      </div>
    </div>

    <!-- Opciones de env칤o (ocultas si no hay datos) -->
    <div id="envio-opciones" class="bg-white border rounded-lg p-6 mb-20 hidden">
      <!-- ...contenido de env칤o por correo y WhatsApp... -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Env칤o por correo -->
        <div class="border rounded-lg p-4">
          <h3 class="font-semibold text-gray-800 mb-3">
            <i class="fas fa-envelope text-blue-500 mr-2"></i>Enviar por Correo
          </h3>
          <div class="space-y-3">
            <input type="email" id="email-destinatario" placeholder="correo@ejemplo.com"
              class="border rounded-lg p-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            <input type="text" id="email-asunto" placeholder="Asunto del correo"
              class="border rounded-lg p-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            <button id="enviar-email-btn"
              class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg w-full flex items-center justify-center relative overflow-hidden transition-all duration-300">
              <span class="btn-text">
                <i class="fas fa-envelope mr-2"></i>Enviar por Correo
              </span>
              <div class="btn-spinner"></div>
            </button>
          </div>
        </div>
        <!-- Env칤o por WhatsApp -->
        <div class="border rounded-lg p-4">
          <h3 class="font-semibold text-gray-800 mb-3">
            <i class="fab fa-whatsapp text-green-500 mr-2"></i>Enviar por WhatsApp
          </h3>
          <div class="space-y-3">
            <input type="tel" id="whatsapp-telefono" placeholder="5512345678"
              class="border rounded-lg p-2 w-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">

            <small class="text-gray-500">Formato: 10 d칤gitos sin espacios</small>
            <button id="enviar-whatsapp-btn"
              class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg w-full flex items-center justify-center relative overflow-hidden transition-all duration-300">
              <span class="btn-text">
                <i class="fab fa-whatsapp mr-2"></i>Enviar por WhatsApp
              </span>
              <div class="btn-spinner"></div>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Profesional para Alertas -->
<div id="custom-alert-modal"
  class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-[9999] transition-opacity duration-300">
  <div id="custom-alert-content"
    class="bg-white rounded-2xl shadow-2xl max-w-md w-11/12 mx-4 transform transition-all duration-300 scale-95 opacity-0">
    <!-- Header del Modal -->
    <div id="custom-alert-header" class="px-6 py-4 border-b border-gray-200 flex items-center gap-3">
      <div id="custom-alert-icon" class="flex-shrink-0">
        <!-- Icono se insertar치 din치micamente -->
      </div>
      <h3 id="custom-alert-title" class="text-lg font-semibold text-gray-900 flex-1">
        Atenci칩n
      </h3>
      <button id="custom-alert-close" class="text-gray-400 hover:text-gray-600 transition-colors">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Cuerpo del Modal -->
    <div class="px-6 py-5">
      <p id="custom-alert-message" class="text-gray-700 text-base leading-relaxed">
        <!-- Mensaje se insertar치 din치micamente -->
      </p>
    </div>

    <!-- Footer del Modal -->
    <div class="px-6 py-4 bg-gray-50 rounded-b-2xl flex justify-end gap-3">
      <button id="custom-alert-cancel"
        class="hidden px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors font-medium">
        Cancelar
      </button>
      <button id="custom-alert-confirm"
        class="px-6 py-2 text-white rounded-lg font-medium transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2">
        Aceptar
      </button>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    let tipoReporteSeleccionado = 'rentas';
    let periodoSeleccionado = 'diario';

    // ============================================
    // FUNCI칍N PARA MOSTRAR MODAL PROFESIONAL
    // ============================================
    function showCustomAlert(message, type = 'info', title = null, onClose = null) {
      const modal = document.getElementById('custom-alert-modal');
      const content = document.getElementById('custom-alert-content');
      const iconContainer = document.getElementById('custom-alert-icon');
      const titleElement = document.getElementById('custom-alert-title');
      const messageElement = document.getElementById('custom-alert-message');
      const confirmBtn = document.getElementById('custom-alert-confirm');
      const closeBtn = document.getElementById('custom-alert-close');

      // Configuraci칩n por tipo
      const config = {
        warning: {
          title: title || 'Advertencia',
          icon: `<svg class="w-8 h-8 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                </svg>`,
          btnColor: 'bg-yellow-500 hover:bg-yellow-600 focus:ring-yellow-500'
        },
        error: {
          title: title || 'Error',
          icon: `<svg class="w-8 h-8 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>`,
          btnColor: 'bg-red-500 hover:bg-red-600 focus:ring-red-500'
        },
        success: {
          title: title || '칄xito',
          icon: `<svg class="w-8 h-8 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>`,
          btnColor: 'bg-green-500 hover:bg-green-600 focus:ring-green-500'
        },
        info: {
          title: title || 'Informaci칩n',
          icon: `<svg class="w-8 h-8 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>`,
          btnColor: 'bg-blue-500 hover:bg-blue-600 focus:ring-blue-500'
        }
      };

      const settings = config[type] || config.info;

      // Actualizar contenido
      iconContainer.innerHTML = settings.icon;
      titleElement.textContent = settings.title;
      messageElement.textContent = message;

      // Actualizar color del bot칩n
      confirmBtn.className = `px-6 py-2 text-white rounded-lg font-medium transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 ${settings.btnColor}`;

      // Mostrar modal con animaci칩n
      modal.classList.remove('hidden');
      modal.classList.add('flex');

      setTimeout(() => {
        content.classList.remove('scale-95', 'opacity-0');
        content.classList.add('scale-100', 'opacity-100');
      }, 10);

      // Funci칩n para cerrar el modal
      const closeModal = () => {
        content.classList.remove('scale-100', 'opacity-100');
        content.classList.add('scale-95', 'opacity-0');

        setTimeout(() => {
          modal.classList.add('hidden');
          modal.classList.remove('flex');

          // Ejecutar callback si existe
          if (typeof onClose === 'function') {
            onClose();
          }
        }, 300);
      };

      // Event listeners para cerrar
      confirmBtn.onclick = closeModal;
      closeBtn.onclick = closeModal;

      // Cerrar al hacer click fuera del modal
      modal.onclick = (e) => {
        if (e.target === modal) {
          closeModal();
        }
      };

      // Cerrar con tecla ESC
      const handleEscape = (e) => {
        if (e.key === 'Escape') {
          closeModal();
          document.removeEventListener('keydown', handleEscape);
        }
      };
      document.addEventListener('keydown', handleEscape);
    }

    // Hacer la funci칩n global para que pueda ser usada desde otros scripts
    window.showCustomAlert = showCustomAlert;

    function notify(message, type = 'info') {
      if (typeof window.showNotification === 'function') {
        window.showNotification(message, type);
      } else {
        alert(message);
      }
    }


    // Funcionalidad para cambiar entre tipos de reporte
    document.querySelectorAll('.report-type-option').forEach(option => {
      option.addEventListener('click', function () {
        // Remover clase active de todas las opciones
        document.querySelectorAll('.report-type-option').forEach(opt => {
          opt.classList.remove('active-report');
          opt.classList.remove('border-blue-500', 'bg-blue-50');
          opt.classList.add('border-gray-200');
        });

        // Agregar clase active a la opci칩n seleccionada
        this.classList.add('active-report');
        this.classList.add('border-blue-500', 'bg-blue-50');
        this.classList.remove('border-gray-200');

        tipoReporteSeleccionado = this.getAttribute('data-type');
      });
    });

    // Helper para formatear fecha a YYYY-MM-DD
    function formatDateYMD(date) {
      const year = date.getFullYear();
      const month = (date.getMonth() + 1).toString().padStart(2, '0');
      const day = date.getDate().toString().padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    // Establecer la fecha actual por defecto para el periodo diario
    const dailyInput = document.getElementById('fecha-diaria');
    if (dailyInput) {
      dailyInput.value = formatDateYMD(new Date());
    }

    // Obtener rango de fechas seg칰n el per칤odo seleccionado y los controles de fecha
    function obtenerRangoFechas() {
      const today = new Date();

      if (periodoSeleccionado === 'diario') {
        const inputDia = document.getElementById('fecha-diaria');
        const valor = inputDia?.value;
        if (!valor) {
          throw new Error('Selecciona una fecha para el reporte diario');
        }
        return { fechaInicio: valor, fechaFin: valor };
      }

      if (periodoSeleccionado === 'semanal') {
        const inputSemana = document.getElementById('fecha-semanal');
        const valor = inputSemana?.value; // Formato esperado: YYYY-Www
        if (!valor) {
          throw new Error('Selecciona una semana para el reporte semanal');
        }

        const [yearStr, weekStr] = valor.split('-W');
        const year = parseInt(yearStr, 10);
        const week = parseInt(weekStr, 10);

        // Aproximaci칩n: tomar el 1 de enero y sumar (week - 1) * 7 d칤as
        const inicio = new Date(year, 0, 1);
        const diaSemana = inicio.getDay(); // 0=Domingo, 1=Lunes, ...
        const ajuste = (diaSemana === 0 ? -6 : 1) - diaSemana; // Mover a lunes de la primera semana
        inicio.setDate(inicio.getDate() + ajuste + (week - 1) * 7);
        const fin = new Date(inicio);
        fin.setDate(inicio.getDate() + 6);

        return { fechaInicio: formatDateYMD(inicio), fechaFin: formatDateYMD(fin) };
      }

      if (periodoSeleccionado === 'quincenal') {
        const inputMes = document.getElementById('fecha-quincenal');
        const valor = inputMes?.value; // Formato esperado: YYYY-MM
        if (!valor) {
          throw new Error('Selecciona un mes para el reporte quincenal');
        }

        const esPrimera = document.getElementById('primera-quincena')?.checked;
        const [yearStr, monthStr] = valor.split('-');
        const year = parseInt(yearStr, 10);
        const month = parseInt(monthStr, 10); // 1-12

        if (esPrimera) {
          const inicio = new Date(year, month - 1, 1);
          const fin = new Date(year, month - 1, 15);
          return { fechaInicio: formatDateYMD(inicio), fechaFin: formatDateYMD(fin) };
        } else {
          const inicio = new Date(year, month - 1, 16);
          const fin = new Date(year, month, 0); // 칔ltimo d칤a del mes
          return { fechaInicio: formatDateYMD(inicio), fechaFin: formatDateYMD(fin) };
        }
      }

      if (periodoSeleccionado === 'mensual') {
        const inputMes = document.getElementById('fecha-mensual');
        const valor = inputMes?.value; // Formato esperado: YYYY-MM
        if (!valor) {
          throw new Error('Selecciona un mes para el reporte mensual');
        }

        const [yearStr, monthStr] = valor.split('-');
        const year = parseInt(yearStr, 10);
        const month = parseInt(monthStr, 10); // 1-12

        const inicio = new Date(year, month - 1, 1);
        const fin = new Date(year, month, 0); // 칔ltimo d칤a del mes
        return { fechaInicio: formatDateYMD(inicio), fechaFin: formatDateYMD(fin) };
      }

      // Fallback: usar hoy
      const fecha = formatDateYMD(today);
      return { fechaInicio: fecha, fechaFin: fecha };
    }

    // Funcionalidad para cambiar entre per칤odos
    document.querySelectorAll('.period-option').forEach(option => {
      option.addEventListener('click', function () {
        // Remover clase active de todas las opciones
        document.querySelectorAll('.period-option').forEach(opt => {
          opt.classList.remove('active');
          opt.classList.remove('border-blue-500', 'bg-blue-50');
          opt.classList.add('border-gray-200');
        });

        // Agregar clase active a la opci칩n seleccionada
        this.classList.add('active');
        this.classList.add('border-blue-500', 'bg-blue-50');
        this.classList.remove('border-gray-200');

        periodoSeleccionado = this.getAttribute('data-period');

        // Mostrar/ocultar selectores de fecha
        document.querySelectorAll('.date-selector').forEach(selector => {
          selector.classList.add('hidden');
        });

        const selectorId = `selector-${periodoSeleccionado}`;
        const selector = document.getElementById(selectorId);
        if (selector) {
          selector.classList.remove('hidden');
        }

        // Establecer valores por defecto en los filtros de fecha seg칰n el per칤odo
        const hoy = new Date();

        if (periodoSeleccionado === 'diario') {
          const inputDia = document.getElementById('fecha-diaria');
          if (inputDia) {
            inputDia.value = formatDateYMD(hoy);
          }
        }

        if (periodoSeleccionado === 'semanal') {
          const inputSemana = document.getElementById('fecha-semanal');
          if (inputSemana) {
            const year = hoy.getFullYear();
            // Calcular n칰mero de semana aproximado
            const inicioAnio = new Date(year, 0, 1);
            const diffMs = hoy - inicioAnio;
            const diffDias = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            const week = Math.floor((diffDias + inicioAnio.getDay()) / 7) + 1;
            const weekStr = week.toString().padStart(2, '0');
            inputSemana.value = `${year}-W${weekStr}`;
          }
        }

        if (periodoSeleccionado === 'quincenal') {
          const inputQuincena = document.getElementById('fecha-quincenal');
          if (inputQuincena) {
            const year = hoy.getFullYear();
            const month = (hoy.getMonth() + 1).toString().padStart(2, '0');
            inputQuincena.value = `${year}-${month}`;
          }

          const radioPrimera = document.getElementById('primera-quincena');
          const radioSegunda = document.getElementById('segunda-quincena');
          if (radioPrimera && radioSegunda) {
            // Seleccionar quincena seg칰n el d칤a actual
            if (hoy.getDate() <= 15) {
              radioPrimera.checked = true;
              radioSegunda.checked = false;
            } else {
              radioPrimera.checked = false;
              radioSegunda.checked = true;
            }
          }
        }

        if (periodoSeleccionado === 'mensual') {
          const inputMes = document.getElementById('fecha-mensual');
          if (inputMes) {
            const year = hoy.getFullYear();
            const month = (hoy.getMonth() + 1).toString().padStart(2, '0');
            inputMes.value = `${year}-${month}`;
          }
        }
      });
    });

    // Generar reporte con animaci칩n
    document.getElementById('generar-reporte-btn').addEventListener('click', async function () {
      const btn = this;
      const container = document.getElementById('reporte-container');

      // Estado de carga din치mico
      let loadingText = "Obteniendo datos...";
      btn.style.setProperty('--btn-loading-text', `"${loadingText}"`);
      btn.classList.add('btn-loading');

      const updateText = setTimeout(() => {
        btn.style.setProperty('--btn-loading-text', '"Generando vista..."');
      }, 1500);

      container.innerHTML = `
          <h2 class="text-xl font-semibold text-gray-700 mb-4">Vista Previa del Reporte</h2>
          <div class="flex justify-center items-center h-40 border border-dashed border-gray-300 rounded-lg">
            <p class="text-gray-500"><i class="fas fa-spinner fa-spin mr-2"></i>Generando reporte...</p>
          </div>`;

      notify('Generando reporte...', 'info');
      try {
        const { fechaInicio, fechaFin } = obtenerRangoFechas();
        const params = new URLSearchParams({ tipo: tipoReporteSeleccionado, fechaInicio, fechaFin });

        const response = await fetch(`/api/rooms/reports/generate?${params}`);
        const data = await response.json();

        if (!response.ok || !data.reporte) {
          throw new Error(data.error || 'Error al generar el reporte');
        }

        const hasData = mostrarReporte(data.reporte);

        if (hasData) {
          notify('Reporte generado correctamente', 'success');
        } else {
          notify('No hay datos disponibles para generar el reporte', 'warning');
        }
        // 칄xito: Animaci칩n temporal
        clearTimeout(updateText);
        btn.classList.remove('btn-loading');
        btn.classList.add('btn-success');
        setTimeout(() => btn.classList.remove('btn-success'), 2000);

      } catch (error) {
        notify(`Error generando reporte: ${error.message}`, 'error');
        console.error('Error:', error);
        clearTimeout(updateText);
        btn.classList.remove('btn-loading');
        btn.classList.add('btn-error');
        setTimeout(() => btn.classList.remove('btn-error'), 2000);

        container.innerHTML = `
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Vista Previa del Reporte</h2>
            <div class="flex justify-center items-center h-40 border border-dashed border-gray-300 rounded-lg">
              <p class="text-red-500">Error: ${error.message}</p>
            </div>`;
        document.getElementById('envio-opciones').classList.add('hidden');
      }
    });

    // Funci칩n para mostrar el reporte en tabla
    function mostrarReporte(reporte) {
      const formatCurrency = (value) => new Intl.NumberFormat('es-MX', { style: 'currency', currency: 'MXN' }).format(value);

      let contenidoHTML = `
          <h2 class="text-xl font-semibold text-gray-700 mb-4">
            <i class="fas fa-chart-bar mr-2"></i>Reporte de ${reporte.tipo.charAt(0).toUpperCase() + reporte.tipo.slice(1)}
          </h2>
        `;

      let hayDatos = false;

      // Si no hay datos, mostrar mensaje y NO mostrar tabla
      if (!reporte.datos || reporte.datos.length === 0) {
        if (reporte.tipo === 'consolidado') {
          const hasRentas = reporte.rentas && reporte.rentas.datos && reporte.rentas.datos.length > 0;
          const hasReservas = reporte.reservaciones && reporte.reservaciones.datos && reporte.reservaciones.datos.length > 0;
          hayDatos = hasRentas || hasReservas;
          if (!hayDatos) {
            contenidoHTML += `
                <div class="text-center py-12">
                  <i class="fas fa-info-circle text-4xl text-slate-400"></i>
                  <h2 class="mt-4 text-xl font-semibold text-slate-700">No se encontraron rentas o reservaciones</h2>
                  <p class="mt-2 text-sm text-slate-500">No hay datos de rentas o reservaciones para el per칤odo seleccionado.</p>
                </div>`;
          }
        } else {
          contenidoHTML += `
              <div class="text-center py-12">
                <i class="fas fa-info-circle text-4xl text-slate-400"></i>
                <h2 class="mt-4 text-xl font-semibold text-slate-700">No se encontraron rentas o reservaciones</h2>
                <p class="mt-2 text-sm text-slate-500">No hay datos de rentas o reservaciones para el per칤odo seleccionado.</p>
              </div>`;
        }
      } else {
        hayDatos = true;
      }

      if (reporte.tipo === 'rentas' && hayDatos) {
        contenidoHTML += `
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
              <div class="bg-blue-100 p-4 rounded-lg">
                <h3 class="font-semibold text-blue-800">Rentas Directas</h3>
                <p class="text-2xl font-bold text-blue-900">${reporte.estadisticas.totalDirectas}</p>
              </div>

              <div class="bg-green-100 p-4 rounded-lg">
                <h3 class="font-semibold text-green-800">Ingreso Directo</h3>
                <p class="text-2xl font-bold text-green-900">${formatCurrency(reporte.estadisticas.ingresosDirectos)}</p>
              </div>
              <div class="bg-teal-100 p-4 rounded-lg">
                <h3 class="font-semibold text-teal-800">Promedio Directo</h3>
                <p class="text-2xl font-bold text-teal-900">${formatCurrency(reporte.estadisticas.promedioIngreso)}</p>
              </div>
            </div>
            <div class="overflow-x-auto">
              <table class="min-w-full bg-white border">
                <thead class="bg-gray-100">
                  <tr>
                    <th class="px-4 py-2 border">Cliente</th>
                    <th class="px-4 py-2 border">Habitaci칩n</th>
                    <th class="px-4 py-2 border">Check-in</th>
                    <th class="px-4 py-2 border">Check-out</th>
                    <th class="px-4 py-2 border">Tipo Pago</th>
                    <th class="px-4 py-2 border">Monto</th>
                  </tr>
                </thead>
                <tbody>
                  ${reporte.datos.map(r => `
                    <tr>
                      <td class="px-4 py-2 border">${r.nombre_cliente}</td>
                      <td class="px-4 py-2 border text-center">${r.numero_habitacion} (${r.tipo_habitacion})</td>
                      <td class="px-4 py-2 border text-center">${new Date(r.fecha_ingreso).toLocaleDateString('es-MX')}</td>
                      <td class="px-4 py-2 border text-center">${new Date(r.fecha_salida).toLocaleDateString('es-MX')}</td>
                      <td class="px-4 py-2 border text-center">${r.tipo_pago}</td>
                      <td class="px-4 py-2 border text-right">${formatCurrency(r.monto)}</td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          `;
      } else if (reporte.tipo === 'reservaciones' && hayDatos) {
        contenidoHTML += `
            <div class="grid grid-cols-1 md:grid-cols-6 gap-4 mb-6">
              <div class="bg-green-100 p-4 rounded-lg">
                <h3 class="font-semibold text-green-800">Reservas Pendientes</h3>
                <p class="text-2xl font-bold text-green-900">${reporte.estadisticas.totalPendientes}</p>
              </div>
              <div class="bg-orange-100 p-4 rounded-lg">
                <h3 class="font-semibold text-orange-800">Reservas Convertidas</h3>
                <p class="text-2xl font-bold text-orange-900">${reporte.estadisticas.totalConvertidas}</p>
              </div>
              <div class="bg-blue-100 p-4 rounded-lg">
                <h3 class="font-semibold text-blue-800">Monto Esperado</h3>
                <p class="text-2xl font-bold text-blue-900">${formatCurrency(reporte.estadisticas.totalMontoEsperado)}</p>
              </div>
              <div class="bg-yellow-100 p-4 rounded-lg">
                <h3 class="font-semibold text-yellow-800">Enganche Recibido</h3>
                <p class="text-2xl font-bold text-yellow-900">${formatCurrency(reporte.estadisticas.totalEnganche)}</p>
              </div>
              <div class="bg-red-100 p-4 rounded-lg">
                <h3 class="font-semibold text-red-800">Pendiente por Cobrar</h3>
                <p class="text-2xl font-bold text-red-900">${formatCurrency(reporte.estadisticas.pendientePorCobrar)}</p>
              </div>
              <div class="bg-teal-100 p-4 rounded-lg">
                <h3 class="font-semibold text-teal-800">Convertidas + Enganche</h3>
                <p class="text-2xl font-bold text-teal-900">${formatCurrency(reporte.estadisticas.totalConvertidasConEnganche)}</p>
              </div>
            </div>
            <div class="overflow-x-auto">
              <table class="min-w-full bg-white border">
                <thead class="bg-gray-100">
                  <tr>
                    <th class="px-4 py-2 border">Cliente</th>
                    <th class="px-4 py-2 border">Habitaci칩n</th>
                    <th class="px-4 py-2 border">Check-in</th>
                    <th class="px-4 py-2 border">Check-out</th>
                    <th class="px-4 py-2 border">Monto Total</th>
                    <th class="px-4 py-2 border">Enganche</th>
                    <th class="px-4 py-2 border">Pendiente</th>
                  </tr>
                </thead>
                <tbody>
                  ${reporte.datos.map(r => `
                    <tr>
                      <td class="px-4 py-2 border">${r.nombre_cliente}</td>
                      <td class="px-4 py-2 border text-center">${r.numero_habitacion} (${r.tipo_habitacion})</td>
                      <td class="px-4 py-2 border text-center">${new Date(r.fecha_ingreso).toLocaleDateString('es-MX')}</td>
                      <td class="px-4 py-2 border text-center">${new Date(r.fecha_salida).toLocaleDateString('es-MX')}</td>
                      <td class="px-4 py-2 border text-right">${formatCurrency(typeof r.monto_total_mostrado !== 'undefined' ? r.monto_total_mostrado : r.monto)}</td>
                      <td class="px-4 py-2 border text-right">${formatCurrency(typeof r.enganche_mostrado !== 'undefined' ? r.enganche_mostrado : (r.enganche || 0))}</td>
                      <td class="px-4 py-2 border text-right">${formatCurrency(typeof r.pendiente_mostrado !== 'undefined' ? r.pendiente_mostrado : (r.monto - (r.enganche || 0)))}</td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          `;
      } else if (reporte.tipo === 'consolidado' && (reporte.rentas || reporte.reservaciones)) {
        const hasRentas = reporte.rentas && reporte.rentas.datos && reporte.rentas.datos.length > 0;
        const hasReservas = reporte.reservaciones && reporte.reservaciones.datos && reporte.reservaciones.datos.length > 0;
        hayDatos = hasRentas || hasReservas;
        if (hayDatos) {
          contenidoHTML += `
              <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
                <div class="bg-blue-100 p-4 rounded-lg">
                  <h3 class="font-semibold text-blue-800">Rentas Directas</h3>
                  <p class="text-2xl font-bold text-blue-900">${reporte.estadisticas.totalRentasDirectas}</p>
                </div>
                <div class="bg-green-100 p-4 rounded-lg">
                  <h3 class="font-semibold text-green-800">Reservas Pendientes</h3>
                  <p class="text-2xl font-bold text-green-900">${reporte.estadisticas.totalReservasPendientes}</p>
                </div>
                <div class="bg-teal-100 p-4 rounded-lg">
                  <h3 class="font-semibold text-teal-800">Reservas Convertidas</h3>
                  <p class="text-2xl font-bold text-teal-900">${reporte.estadisticas.totalReservasConvertidas}</p>
                </div>
                <div class="bg-purple-100 p-4 rounded-lg">
                  <h3 class="font-semibold text-purple-800">Ingresos Reales</h3>
                  <p class="text-2xl font-bold text-purple-900">${formatCurrency(reporte.estadisticas.ingresosReales)}</p>
                </div>
                <div class="bg-yellow-100 p-4 rounded-lg">
                  <h3 class="font-semibold text-yellow-800">Ingresos Esperados</h3>
                  <p class="text-2xl font-bold text-yellow-900">${formatCurrency(reporte.estadisticas.ingresosEsperados)}</p>
                </div>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div>
                  <h3 class="font-semibold text-gray-800 mb-3">游늵 Rentas (${reporte.rentas.estadisticas.totalRentas})</h3>
                  ${hasRentas ? `
                  <div class="bg-blue-50 p-4 rounded-lg">
                    <p class="text-sm"><strong>Ingresos:</strong> ${formatCurrency(reporte.rentas.estadisticas.totalIngresos)}</p>
                    <p class="text-sm"><strong>Promedio:</strong> ${formatCurrency(reporte.rentas.estadisticas.promedioIngreso)}</p>
                  </div>
                  <div class="overflow-x-auto mt-2">
                    <table class="min-w-full bg-white border">
                      <thead class="bg-gray-100">
                        <tr>
                          <th class="px-4 py-2 border">Cliente</th>
                          <th class="px-4 py-2 border">Habitaci칩n</th>
                          <th class="px-4 py-2 border">Check-in</th>
                          <th class="px-4 py-2 border">Check-out</th>
                          <th class="px-4 py-2 border">Tipo Pago</th>
                          <th class="px-4 py-2 border">Monto</th>
                        </tr>
                      </thead>
                      <tbody>
                        ${reporte.rentas.datos.map(r => `
                          <tr>
                            <td class="px-4 py-2 border">${r.nombre_cliente}</td>
                            <td class="px-4 py-2 border text-center">${r.numero_habitacion} (${r.tipo_habitacion})</td>
                            <td class="px-4 py-2 border text-center">${new Date(r.fecha_ingreso).toLocaleDateString('es-MX')}</td>
                            <td class="px-4 py-2 border text-center">${new Date(r.fecha_salida).toLocaleDateString('es-MX')}</td>
                            <td class="px-4 py-2 border text-center">${r.tipo_pago}</td>
                            <td class="px-4 py-2 border text-right">${formatCurrency(r.monto)}</td>
                          </tr>
                        `).join('')}
                      </tbody>
                    </table>
                  </div>
                  ` : `<div class="text-sm text-gray-500">No se encontraron rentas.</div>`}
                </div>
                <div>
                  <h3 class="font-semibold text-gray-800 mb-3">游늰 Reservaciones (${reporte.reservaciones.estadisticas.totalReservaciones})</h3>
                  ${hasReservas ? `
                  <div class="bg-green-50 p-4 rounded-lg">
                    <p class="text-sm"><strong>Monto Esperado:</strong> ${formatCurrency(reporte.reservaciones.estadisticas.totalMontoEsperado)}</p>
                    <p class="text-sm"><strong>Enganche:</strong> ${formatCurrency(reporte.reservaciones.estadisticas.totalEnganche)}</p>
                    <p class="text-sm"><strong>Pendiente:</strong> ${formatCurrency(reporte.reservaciones.estadisticas.pendientePorCobrar)}</p>
                    <p class="text-sm"><strong>Convertidas + Enganche:</strong> ${formatCurrency(reporte.reservaciones.estadisticas.totalConvertidasConEnganche)}</p>
                  </div>
                  <div class="overflow-x-auto mt-2">
                    <table class="min-w-full bg-white border">
                      <thead class="bg-gray-100">
                        <tr>
                          <th class="px-4 py-2 border">Cliente</th>
                          <th class="px-4 py-2 border">Habitaci칩n</th>
                          <th class="px-4 py-2 border">Check-in</th>
                          <th class="px-4 py-2 border">Check-out</th>
                          <th class="px-4 py-2 border">Monto Total</th>
                          <th class="px-4 py-2 border">Enganche</th>
                          <th class="px-4 py-2 border">Pendiente</th>
                        </tr>
                      </thead>
                      <tbody>
                        ${reporte.reservaciones.datos.map(r => `
                          <tr>
                            <td class="px-4 py-2 border">${r.nombre_cliente}</td>
                            <td class="px-4 py-2 border text-center">${r.numero_habitacion} (${r.tipo_habitacion})</td>
                            <td class="px-4 py-2 border text-center">${new Date(r.fecha_ingreso).toLocaleDateString('es-MX')}</td>
                            <td class="px-4 py-2 border text-center">${new Date(r.fecha_salida).toLocaleDateString('es-MX')}</td>
                            <td class="px-4 py-2 border text-right">${formatCurrency(typeof r.monto_total_mostrado !== 'undefined' ? r.monto_total_mostrado : r.monto)}</td>
                            <td class="px-4 py-2 border text-right">${formatCurrency(typeof r.enganche_mostrado !== 'undefined' ? r.enganche_mostrado : (r.enganche || 0))}</td>
                            <td class="px-4 py-2 border text-right">${formatCurrency(typeof r.pendiente_mostrado !== 'undefined' ? r.pendiente_mostrado : (r.monto - (r.enganche || 0)))}</td>
                          </tr>
                        `).join('')}
                      </tbody>
                    </table>
                  </div>
                  ` : `<div class="text-sm text-gray-500">No se encontraron reservaciones.</div>`}
                </div>
              </div>
            `;
        }
      }

      contenidoHTML += `
          <div class="text-sm text-gray-500 mt-4 p-4 bg-gray-50 rounded-lg">
            <p><strong>游늰 Per칤odo:</strong> ${new Date(reporte.fechaInicio).toLocaleDateString('es-MX')} - ${new Date(reporte.fechaFin).toLocaleDateString('es-MX')}</p>
            <p><strong>游뎷 Generado:</strong> ${new Date().toLocaleString('es-MX')}</p>
          </div>
        `;

      document.getElementById('reporte-container').innerHTML = contenidoHTML;

      // Mostrar opciones de env칤o solo si hay datos
      const envioOpciones = document.getElementById('envio-opciones');
      if (hayDatos) {
        envioOpciones.classList.remove('hidden');
      } else {
        envioOpciones.classList.add('hidden');
      }

      return hayDatos;
    }

    // Funci칩n gen칠rica para enviar reportes (Email/WhatsApp)
    async function enviarReporte(btnId, endpoint, extraData) {
      const btn = document.getElementById(btnId);
      const btnText = btn.querySelector('.btn-text');
      const originalContent = btnText.innerHTML;

      // Estado de carga din치mico
      btn.style.setProperty('--btn-loading-text', '"Preparando PDF..."');
      btn.classList.add('btn-loading');

      const updateText = setTimeout(() => {
        btn.style.setProperty('--btn-loading-text', '"Enviando reporte..."');
      }, 1500);

      notify('Preparando PDF para env칤o...', 'info');
      try {
        const { fechaInicio, fechaFin } = obtenerRangoFechas();
        const payload = {
          tipo: tipoReporteSeleccionado,
          fechaInicio,
          fechaFin,
          periodo: periodoSeleccionado,
          ...extraData
        };

        const response = await fetch(endpoint, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        const data = await response.json();

        if (!response.ok) throw new Error(data.error || 'Error al enviar');

        notify(data.message || 'Reporte enviado correctamente', 'success');
        // 칄xito
        clearTimeout(updateText);
        btn.classList.remove('btn-loading');
        btn.classList.add('btn-success');
        btnText.innerHTML = '<i class="fas fa-check mr-2"></i>춰Enviado!';

        setTimeout(() => {
          btn.classList.remove('btn-success');
          btnText.innerHTML = originalContent;
        }, 3000);

      } catch (error) {
        notify(`Error al enviar: ${error.message}`, 'error');
        console.error('Error al enviar:', error);
        clearTimeout(updateText);
        btn.classList.remove('btn-loading');
        btn.classList.add('btn-error');

        setTimeout(() => {
          btn.classList.remove('btn-error');
          btnText.innerHTML = originalContent;
        }, 3000);
      }
    }

    // Event listeners para botones de env칤o
    document.getElementById('enviar-email-btn').addEventListener('click', () => {
      const email = document.getElementById('email-destinatario').value;
      const asunto = document.getElementById('email-asunto').value;
      enviarReporte('enviar-email-btn', '/api/rooms/reports/send-email', { email, asunto });
    });

    document.getElementById('enviar-whatsapp-btn').addEventListener('click', () => {
      const telefono = document.getElementById('whatsapp-telefono').value;
      enviarReporte('enviar-whatsapp-btn', '/api/rooms/reports/send-whatsapp', { telefono });
    });
  });
</script>

<!-- Scripts de validaci칩n de reportes -->
<script src="/js/ModuleRooms/js/reportsInputValidation.js"></script>
