<div class="max-w-6xl mx-auto px-3 sm:px-6 lg:px-8 pt-14 sm:pt-5 pb-20">
  <!-- Loading Overlay -->
  <div id="loadingOverlay" class="fixed inset-0 z-[60] bg-white/80 backdrop-blur-sm flex items-center justify-center">
    <div class="flex flex-col items-center gap-3">
      <svg class="w-10 h-10 text-blue-700 animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" aria-hidden="true" role="img">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
      </svg>
      <p class="text-sm text-blue-900 font-medium">Cargando habitaciones...</p>
    </div>
  </div>
  <!-- Header -->
  <header class="text-center py-5 sm:py-8 px-2">
    <h1 class="text-2xl sm:text-4xl font-extrabold text-blue-900 tracking-tight mb-3 leading-tight">
      <span class="block sm:inline"></span>
      <span class="block sm:inline">Habitaciones</span>
    </h1>
    <p class="text-gray-600 mb-5 sm:mb-6 text-sm sm:text-base ">Gestiona las habitaciones del hotel</p>
    {{>buttons}}
  </header>

  <!-- Skeletons mientras carga -->
  <section id="roomsSkeletons" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
    <div class="rounded-xl border border-slate-200 bg-white p-3 animate-pulse">
      <div class="h-5 w-40 bg-slate-200 rounded mb-3"></div>
      <div class="h-4 w-24 bg-slate-200 rounded mb-2"></div>
      <div class="h-6 w-28 bg-slate-200 rounded"></div>
      <div class="mt-4 flex gap-2">
        <div class="h-8 w-24 bg-slate-200 rounded"></div>
        <div class="h-8 w-20 bg-slate-200 rounded"></div>
      </div>
    </div>
    <div class="rounded-xl border border-slate-200 bg-white p-3 animate-pulse">
      <div class="h-5 w-40 bg-slate-200 rounded mb-3"></div>
      <div class="h-4 w-24 bg-slate-200 rounded mb-2"></div>
      <div class="h-6 w-28 bg-slate-200 rounded"></div>
      <div class="mt-4 flex gap-2">
        <div class="h-8 w-24 bg-slate-200 rounded"></div>
        <div class="h-8 w-20 bg-slate-200 rounded"></div>
      </div>
    </div>
    <div class="rounded-xl border border-slate-200 bg-white p-3 animate-pulse">
      <div class="h-5 w-40 bg-slate-200 rounded mb-3"></div>
      <div class="h-4 w-24 bg-slate-200 rounded mb-2"></div>
      <div class="h-6 w-28 bg-slate-200 rounded"></div>
      <div class="mt-4 flex gap-2">
        <div class="h-8 w-24 bg-slate-200 rounded"></div>
        <div class="h-8 w-20 bg-slate-200 rounded"></div>
      </div>
    </div>
    <div class="rounded-xl border border-slate-200 bg-white p-3 animate-pulse">
      <div class="h-5 w-40 bg-slate-200 rounded mb-3"></div>
      <div class="h-4 w-24 bg-slate-200 rounded mb-2"></div>
      <div class="h-6 w-28 bg-slate-200 rounded"></div>
      <div class="mt-4 flex gap-2">
        <div class="h-8 w-24 bg-slate-200 rounded"></div>
        <div class="h-8 w-20 bg-slate-200 rounded"></div>
      </div>
    </div>
    <div class="rounded-xl border border-slate-200 bg-white p-3 animate-pulse">
      <div class="h-5 w-40 bg-slate-200 rounded mb-3"></div>
      <div class="h-4 w-24 bg-slate-200 rounded mb-2"></div>
      <div class="h-6 w-28 bg-slate-200 rounded"></div>
      <div class="mt-4 flex gap-2">
        <div class="h-8 w-24 bg-slate-200 rounded"></div>
        <div class="h-8 w-20 bg-slate-200 rounded"></div>
      </div>
    </div>
    <div class="rounded-xl border border-slate-200 bg-white p-3 animate-pulse">
      <div class="h-5 w-40 bg-slate-200 rounded mb-3"></div>
      <div class="h-4 w-24 bg-slate-200 rounded mb-2"></div>
      <div class="h-6 w-28 bg-slate-200 rounded"></div>
      <div class="mt-4 flex gap-2">
        <div class="h-8 w-24 bg-slate-200 rounded"></div>
        <div class="h-8 w-20 bg-slate-200 rounded"></div>
      </div>
    </div>
  </section>

  <!-- Grid de Habitaciones -->
  <section id="roomsGrid" class="grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 px-2 sm:px-0 hidden">
    {{#each habitaciones}}
    <div class="group room-card bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden flex flex-col justify-between transform transition-all duration-500 hover:-translate-y-1 hover:shadow-2xl opacity-0 translate-y-2">
      <!-- Header de la card -->
      <div class="bg-gradient-to-r from-blue-600 to-blue-700 p-4 text-white">
        <h2 class="text-xl font-bold flex items-center gap-3">
          <i class="fa-solid fa-bed text-2xl"></i>
          Habitaci贸n {{this.numero}}
        </h2>
        <p class="text-blue-100 mt-1 flex items-center gap-2">
          <i class="fa-solid fa-home text-sm"></i>
          <span class="capitalize">Tipo: {{this.tipo}}</span>
        </p>
      </div>

      <!-- Contenido de la card -->
      <div class="p-4 flex-1">
        <div class="mb-4">
          <p class="text-sm text-gray-600 mb-2 flex items-center gap-2">
            <i class="fa-solid fa-info-circle text-gray-400"></i>
            <span class="font-medium">Estado actual:</span>
          </p>
          {{#if (eq this.estado 'disponible')}}
            <div class="inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-green-100 text-green-800 font-medium border border-green-200">
              <i class="fa-solid fa-check-circle text-green-600 text-lg"></i>
              <span>Disponible</span>
            </div>
          {{/if}}
          {{#if (eq this.estado 'ocupado')}}
            <div class="inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-red-100 text-red-800 font-medium border border-red-200">
              <i class="fa-solid fa-user text-red-600 text-lg"></i>
              <span>Ocupado</span>
            </div>
          {{/if}}
          {{#if (eq this.estado 'limpieza')}}
            <div class="inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-orange-100 text-orange-800 font-medium border border-orange-200 cursor-pointer hover:bg-orange-200 transition-all duration-200 animate-pulse"
                  onclick="openModal({{this.id}})">
              <i class="fa-solid fa-broom text-orange-600 text-lg"></i>
              <span>En Limpieza</span>
            </div>
          {{/if}}
        </div>
      </div>

      <!-- Botones de acci贸n -->
      <div class="p-4 pt-0">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          {{! Bot贸n de Reservar siempre activo }}
          <a href="/rooms/reservar/{{this.id}}"
             class="inline-flex items-center justify-center gap-2 px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-xl shadow-lg transition-all duration-200 hover:scale-105 active:scale-95 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2">
             <i class="fa-solid fa-calendar-check text-lg"></i>
             <span>Reservar</span>
          </a>

          {{! Bot贸n de Rentar con validaci贸n de estado }}
          {{#if (eq this.estado 'disponible')}}
            <a href="/rooms/rentar/{{this.id}}"
               class="inline-flex items-center justify-center gap-2 px-4 py-3 bg-green-600 hover:bg-green-700 text-white font-medium rounded-xl shadow-lg transition-all duration-200 hover:scale-105 active:scale-95 focus:outline-none focus:ring-2 focus:ring-green-400 focus:ring-offset-2">
               <i class="fa-solid fa-key text-lg"></i>
               <span>Rentar</span>
            </a>
          {{else}}
            <span class="inline-flex items-center justify-center gap-2 px-4 py-3 bg-gray-400 text-white font-medium rounded-xl cursor-not-allowed">
              <i class="fa-solid fa-key text-lg"></i>
              <span>Rentar</span>
            </span>
          {{/if}}
        </div>
      </div>
    </div>
    {{/each}}
  </section>
</div>

<!-- Modales de limpieza fuera de los cards -->
{{#each habitaciones}}
  {{#if (eq this.estado 'limpieza')}}
  <div id="modal-clean-{{this.id}}" class="fixed inset-0 z-[9999] bg-black bg-opacity-50 hidden items-center justify-center px-4">
    <div class="bg-white rounded-lg shadow-2xl p-6 w-full max-w-sm sm:max-w-md">
      <h2 class="text-lg sm:text-xl font-bold mb-4 text-orange-700 text-center">Confirmar limpieza</h2>
      <p class="mb-6 text-gray-700 text-sm sm:text-base text-center">
        驴Deseas cambiar el estado a <span class="font-bold text-gray-800">Disponible</span> para la habitaci贸n <span class="font-bold text-blue-600">{{this.numero}}</span>?
      </p>
      <form action="/rooms/changes/status/{{this.id}}" method="POST" class="flex flex-col gap-3 w-full">
        <input type="hidden" name="status" value="disponible" />
        <div class="flex flex-col sm:flex-row justify-end gap-2">
          <button type="button" onclick="closeModal({{this.id}})"
                  class="px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-800 rounded-lg font-semibold w-full sm:w-auto transition-colors">Cancelar</button>
          <button type="submit"
                  class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-semibold w-full sm:w-auto transition-colors">Confirmar</button>
        </div>
      </form>
    </div>
  </div>
  {{/if}}
{{/each}}


<script>
  // Funciones para abrir y cerrar modales de limpieza
  function openModal(roomId) {
    const modal = document.getElementById(`modal-clean-${roomId}`);
    if (modal) {
      modal.classList.remove('hidden');
      modal.classList.add('flex', 'items-center', 'justify-center');
    }
  }

  function closeModal(roomId) {
    const modal = document.getElementById(`modal-clean-${roomId}`);
    if (modal) {
      modal.classList.add('hidden');
      modal.classList.remove('flex', 'items-center', 'justify-center');
    }
  }

  // Funci贸n para mostrar notificaciones
  function showNotification(message, type = 'success') {
    const notification = document.createElement('div');
    notification.className = `fixed top-20 right-4 z-[70] px-6 py-4 rounded-lg text-white font-medium shadow-2xl transition-all duration-300 transform translate-x-0 ${
      type === 'success' ? 'bg-green-500' :
      type === 'error' ? 'bg-red-500' :
      type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500'
    }`;
    notification.innerHTML = `
      <div class="flex items-center gap-3">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
          <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z" clip-rule="evenodd" />
        </svg>
        <span>${message}</span>
      </div>
    `;
    notification.setAttribute('role', 'status');
    document.body.appendChild(notification);

    // Animaci贸n de entrada
    setTimeout(() => notification.style.transform = 'translateX(0)', 10);

    // Remover despu茅s de 5 segundos
    setTimeout(() => {
      notification.style.opacity = '0';
      notification.style.transform = 'translateX(100%)';
      setTimeout(() => notification.remove(), 300);
    }, 5000);
  }

  document.addEventListener('DOMContentLoaded', function() {
    const loadingOverlay = document.getElementById('loadingOverlay');
    const roomsGrid = document.getElementById('roomsGrid');
    const roomsSkeletons = document.getElementById('roomsSkeletons');
    const roomCards = document.querySelectorAll('.room-card');

    function showRooms() {
      // Ocultar overlay y mostrar grid
      loadingOverlay.classList.add('hidden');
      roomsSkeletons.classList.add('hidden');
      roomsGrid.classList.remove('hidden');
      roomsGrid.classList.add('grid');

      // Animar la entrada de las tarjetas
      roomCards.forEach((card, index) => {
        setTimeout(() => {
          card.classList.remove('opacity-0', 'translate-y-2');
        }, index * 100);
      });
    }

    // Carga inicial
    setTimeout(showRooms, 500);

    // Mostrar overlay al navegar a Reservar/Rentar
    roomsGrid.addEventListener('click', (e) => {
      const link = e.target.closest('a[href^="/rooms/"]');
      if (link) {
        loadingOverlay.classList.remove('hidden');
      }
    }, true);

    // Manejar el back/forward cache del navegador
    window.addEventListener('pageshow', function(event) {
      if (event.persisted) {
        // La p谩gina se restaur贸 desde la cach茅, forzar un estado limpio
        loadingOverlay.classList.add('hidden'); // Asegurarse de que el overlay est茅 oculto
        showRooms();
      }
    });
  });
</script>
