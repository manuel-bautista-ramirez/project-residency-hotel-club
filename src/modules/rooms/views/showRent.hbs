<div class="h-screen max-w-7xl mx-auto px-3 sm:px-4 pt-16 sm:pt-20 pb-1 flex flex-col overflow-hidden">
  <div class="flex-none">
    {{>buttons}}
  </div>

  {{#if allRentas}}

  <!-- Loading Overlay -->
  <div id="rentsLoadingOverlay"
    class="fixed inset-0 z-[60] bg-white/80 backdrop-blur-sm flex items-center justify-center hidden">
    <div class="flex flex-col items-center gap-3">
      <svg class="w-10 h-10 text-blue-700 animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none"
        viewBox="0 0 24 24" aria-hidden="true" role="img">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
      </svg>
      <p class="text-sm text-blue-900 font-medium">Cargando rentas...</p>
    </div>
  </div>

  <div class="pt-2"></div>
  <!-- TABLA CON SCROLL DINÁMICO - Muestra 4 filas completas + header, scroll a partir de la 5ta -->
  <div id="tableSection"
    class="w-full bg-white rounded-lg shadow border border-gray-200 overflow-hidden hidden lg:block ">

    <!-- Header de búsqueda -->
    <div class="bg-blue-900 text-white p-3 border-b border-blue-800">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
        <div class="flex-1">
          <input id="rentSearch" type="text" placeholder="Buscar por cliente, habitación, monto..."
            class="w-full px-3 py-2 rounded border border-blue-300 bg-white text-gray-800 text-sm">
        </div>
        <div class="flex items-center gap-2">
          <div class="bg-blue-800 rounded px-3 py-2 text-sm min-w-[140px]">
            <div class="flex justify-between items-center gap-2">
              <span class="font-semibold">Resumen:</span>
              <span id="rentCount" class="font-bold">
                {{#if allRentas.length}}
                {{allRentas.length}}
                {{else}}
                0
                {{/if}}
              </span>
            </div>
          </div>

          <!-- Controles de Paginación Desktop -->
          <div class="bg-blue-800 rounded px-2 py-2 text-sm flex items-center gap-2 text-white">
            <button id="prevPageBtn"
              class="w-6 h-6 flex items-center justify-center rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
              <i class="fa-solid fa-chevron-left text-xs"></i>
            </button>
            <span id="pageIndicator" class="font-mono text-xs min-w-[30px] text-center">1/1</span>
            <button id="nextPageBtn"
              class="w-6 h-6 flex items-center justify-center rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
              <i class="fa-solid fa-chevron-right text-xs"></i>
            </button>
          </div>

          <button id="rentReset" class="bg-blue-800 hover:bg-blue-700 text-white px-3 py-2 rounded text-sm">
            Limpiar
          </button>
        </div>
      </div>
    </div>

    <!-- CONTENEDOR DE TABLA CON ALTURA DINÁMICA -->
    <div id="rentasTableContainer" class="overflow-auto">
      <!-- Altura se ajusta automáticamente según número de filas (1-4 sin scroll, 5+ con scroll) -->

      <table class="w-full min-w-max">
        <!-- HEADER FIJO -->
        <thead class="sticky top-0 bg-white z-10 border-b">
          <tr class="bg-gray-50">
            <th class="p-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider border-r">
              <i class="fa-solid fa-user mr-1.5"></i>CLIENTE
            </th>
            <th class="p-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider border-r">
              <i class="fa-solid fa-bed mr-1.5"></i>HAB.
            </th>
            <th class="p-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider border-r">
              <i class="fa-regular fa-calendar-plus mr-1.5"></i>INGRESO
            </th>
            <th class="p-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider border-r">
              <i class="fa-regular fa-calendar-check mr-1.5"></i>SALIDA
            </th>
            <th class="p-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider border-r">
              <i class="fa-solid fa-clock mr-1.5"></i>ESTADO
            </th>
            <th class="p-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider border-r">
              <i class="fa-solid fa-credit-card mr-1.5"></i>PAGO
            </th>
            <th class="p-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider border-r">
              <i class="fa-solid fa-coins mr-1.5"></i>MONTO
            </th>
            <th class="p-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">
              <i class="fa-solid fa-wrench mr-1.5"></i>ACCIONES
            </th>
          </tr>
        </thead>

        <!-- CUERPO DE LA TABLA -->
        <tbody id="rentasTableBody">
          {{#if allRentas.length}}
          {{#each allRentas}}
          <tr class="border-b hover:bg-gray-50 transition-colors rent-reveal" data-nombre="{{this.nombre_cliente}}"
            data-hab="{{this.numero_habitacion}}" data-ingreso="{{this.fecha_ingreso}}"
            data-salida="{{this.fecha_salida}}" data-origen="{{this.origen_clave}}" data-pago="{{this.tipo_pago}}"
            data-monto="{{this.monto}}" data-letras="{{this.monto_letras}}">
            <!-- Cada fila tiene altura fija de 3.5rem (56px) -->
            <td class="p-3 border-r align-middle" style="height: 3.5rem;">
              <div class="flex items-center">
                <div class="w-6 h-6 rounded-full bg-blue-500 flex items-center justify-center mr-2">
                  <i class="fas fa-user text-white text-xs"></i>
                </div>
                <span class="text-sm font-medium truncate">{{this.nombre_cliente}}</span>
              </div>
            </td>

            <td class="p-3 border-r align-middle" style="height: 3.5rem;">
              <div class="flex items-center justify-center">
                <div class="w-6 h-6 rounded-full bg-purple-100 flex items-center justify-center mr-1.5">
                  <i class="fa-solid fa-bed text-purple-600 text-xs"></i>
                </div>
                <span class="text-sm font-bold text-gray-900">{{this.numero_habitacion}}</span>
              </div>
            </td>

            <td class="p-3 border-r align-middle" style="height: 3.5rem;">
              <div class="flex items-center">
                <i class="fa-regular fa-calendar-plus text-green-600 mr-1.5 text-sm"></i>
                <span class="text-sm text-gray-900">{{this.fecha_ingreso}}</span>
              </div>
            </td>

            <td class="p-3 border-r align-middle" style="height: 3.5rem;">
              <div class="flex items-center">
                <i class="fa-regular fa-calendar-check text-blue-600 mr-1.5 text-sm"></i>
                <span class="text-sm text-gray-900">{{this.fecha_salida}}</span>
              </div>
            </td>

            <td class="p-3 border-r align-middle" style="height: 3.5rem;">
              {{#if (eq this.estado_tiempo 'corriente')}}
              <span
                class="inline-flex items-center px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                <i class="fa-solid fa-clock mr-1.5"></i>
                Activa
              </span>
              {{else}}
              <span
                class="inline-flex items-center px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">
                <i class="fa-solid fa-exclamation-triangle mr-1.5"></i>
                Inactiva
              </span>
              {{/if}}
            </td>

            <td class="p-3 border-r align-middle" style="height: 3.5rem;">
              <div class="flex items-center">
                <i class="fa-solid fa-credit-card text-indigo-600 mr-1.5 text-sm"></i>
                <span class="text-sm text-gray-900 capitalize">{{this.tipo_pago}}</span>
              </div>
            </td>

            <td class="p-3 border-r align-middle" style="height: 3.5rem;">
              <div class="flex items-center">
                <i class="fa-solid fa-coins text-yellow-600 mr-1.5 text-sm"></i>
                <span class="text-sm font-bold text-gray-900">${{this.monto}}</span>
              </div>
            </td>

            <td class="p-3 align-middle" style="height: 3.5rem;">
              <div class="flex space-x-2 justify-center">
                {{#if (eq this.estado_tiempo 'corriente')}}
                <button type="button"
                  onclick="openDesocuparModal({{this.id_renta}}, '{{this.numero_habitacion}}', '{{this.nombre_cliente}}')"
                  class="text-green-600 hover:text-green-800 p-1.5 rounded hover:bg-green-50 transition-colors"
                  title="Desocupar habitación">
                  <i class="fa-solid fa-door-open text-base"></i>
                </button>
                {{else}}
                <button type="button" disabled class="text-gray-400 p-1.5 rounded cursor-not-allowed"
                  title="No se puede desocupar una renta expirada">
                  <i class="fa-solid fa-ban text-base"></i>
                </button>
                {{/if}}
                {{#if (eq @root.user.role 'Administrador')}}
                <button type="button"
                  onclick="openDeleteModal({{this.id_renta}}, '{{this.numero_habitacion}}', '{{this.nombre_cliente}}')"
                  class="text-red-600 hover:text-red-800 p-1.5 rounded hover:bg-red-50 transition-colors"
                  title="Eliminar renta">
                  <i class="fa-solid fa-trash-can text-base"></i>
                </button>
                {{/if}}
              </div>
            </td>
          </tr>
          {{/each}}
          {{else}}
          <!-- Estado vacío -->
          <tr>
            <td colspan="10" class="p-8 text-center text-gray-500">
              <div class="flex flex-col items-center">
                <i class="fas fa-inbox text-4xl text-gray-300 mb-2"></i>
                <p class="text-sm">No hay rentas para mostrar</p>
              </div>
            </td>
          </tr>
          {{/if}}
        </tbody>
        <!-- Fila de no resultados (oculta por defecto) -->
        <tbody id="noResultsBody" class="hidden">
          <tr>
            <td colspan="10" class="p-8 text-center text-gray-500">
              <div class="flex flex-col items-center">
                <i class="fas fa-search text-4xl text-gray-300 mb-2"></i>
                <p class="text-sm font-medium">No se encontraron resultados para tu búsqueda</p>
                <p class="text-xs text-gray-400 mt-1">Intenta con otros términos</p>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- SECCIÓN MEJORADA PARA MÓVILES Y TABLETS -->
  <div id="mobileTabletSection" class="lg:hidden flex-1 flex flex-col overflow-hidden">

    <!-- Controles de búsqueda móvil -->
    <div id="rentControlsMobile" class="flex-none mb-4">
      <div class="bg-blue-900 text-white px-3 py-3 rounded-xl shadow-lg">
        <div class="flex flex-col gap-3">
          <!-- Campo de búsqueda -->
          <div>
            <label for="rentSearchMobile" class="text-xs font-semibold tracking-wide text-blue-100 uppercase block mb-1">
              Buscar rentas
            </label>
            <div class="relative">
              <input id="rentSearchMobile" type="text"
                placeholder="Buscar por cliente, habitación, monto..."
                class="w-full px-4 py-3 text-sm border border-blue-200/70 rounded-lg focus:ring-2 focus:ring-blue-200 focus:border-blue-200 bg-white/95 text-slate-800">
              <i class="fa-solid fa-search absolute right-3 top-3.5 text-gray-400 text-sm"></i>
            </div>
          </div>

          <!-- Estadísticas y controles -->
          <div class="flex flex-wrap items-center justify-between gap-3 pt-2 border-t border-blue-800">
            <!-- Contador -->
            <div class="flex items-center gap-2">
              <div class="bg-blue-800 rounded-lg px-3 py-1.5">
                <div class="flex items-center gap-2">
                  <span class="text-xs font-semibold text-blue-100">Total:</span>
                  <span id="rentCountMobile" class="text-sm font-bold text-white">
                    {{#if allRentas.length}}
                    {{allRentas.length}}
                    {{else}}
                    0
                    {{/if}}
                  </span>
                </div>
              </div>
            </div>

            <!-- Controles de paginación móvil -->
            <div class="flex items-center gap-2">
              <div class="bg-blue-800/50 rounded-lg px-2 py-1 flex items-center gap-2 text-blue-100">
                <button id="prevPageBtnMobile"
                  class="w-6 h-6 flex items-center justify-center rounded hover:bg-blue-700 disabled:opacity-50">
                  <i class="fa-solid fa-chevron-left text-xs"></i>
                </button>
                <span id="pageIndicatorMobile" class="text-xs font-mono min-w-[40px] text-center">1/1</span>
                <button id="nextPageBtnMobile"
                  class="w-6 h-6 flex items-center justify-center rounded hover:bg-blue-700 disabled:opacity-50">
                  <i class="fa-solid fa-chevron-right text-xs"></i>
                </button>
              </div>

              <button id="rentResetMobile"
                class="px-3 py-1.5 text-xs bg-blue-800/50 hover:bg-blue-700/70 text-blue-100 rounded-lg inline-flex items-center gap-1.5 transition-colors">
                <i class="fa-solid fa-eraser"></i>
                Limpiar
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Grid de cards responsiva -->
    <div id="cardsSection" class="flex-1 overflow-y-auto pb-20">
      <div class="grid gap-4 sm:gap-5 grid-cols-1 md:grid-cols-2">
        {{#each allRentas}}
        <article
          class="bg-white rounded-xl shadow-lg overflow-hidden rent-reveal opacity-0 translate-y-1 transition-all duration-500"
          data-item-id="{{this.id_renta}}" data-nombre="{{this.nombre_cliente}}" data-hab="{{this.numero_habitacion}}"
          data-ingreso="{{this.fecha_ingreso}}" data-salida="{{this.fecha_salida}}" data-origen="{{this.origen_clave}}"
          data-pago="{{this.tipo_pago}}" data-monto="{{this.monto}}" data-letras="{{this.monto_letras}}">

          <!-- Header de la card -->
          <div class="bg-gradient-to-r from-blue-900 to-blue-800 text-white px-4 py-3">
            <div class="flex justify-between items-center">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-blue-700 flex items-center justify-center">
                  <i class="fa-solid fa-bed text-lg"></i>
                </div>
                <div>
                  <h3 class="font-bold text-base">Hab. {{this.numero_habitacion}}</h3>
                  <p class="text-sm text-blue-200 truncate max-w-[200px]">{{this.nombre_cliente}}</p>
                </div>
              </div>
              {{#if (eq this.origen_clave 'directa')}}
              <span class="bg-emerald-500/20 text-emerald-300 px-2 py-1 rounded-full text-xs font-medium">
                Directa
              </span>
              {{else}}
              <span class="bg-blue-500/20 text-blue-300 px-2 py-1 rounded-full text-xs font-medium">
                Conversión
              </span>
              {{/if}}
            </div>
          </div>

          <!-- Contenido de la card -->
          <div class="p-4 space-y-4">
            <!-- Información principal -->
            <div class="grid grid-cols-2 gap-4">
              <div class="space-y-1">
                <div class="text-xs text-gray-500 font-medium inline-flex items-center gap-1">
                  <i class="fa-regular fa-calendar-plus text-green-600"></i>
                  Ingreso
                </div>
                <div class="text-sm font-medium text-gray-900 fecha-ingreso-card">{{this.fecha_ingreso}}</div>
              </div>

              <div class="space-y-1">
                <div class="text-xs text-gray-500 font-medium inline-flex items-center gap-1">
                  <i class="fa-regular fa-calendar-check text-blue-600"></i>
                  Salida
                </div>
                <div class="text-sm font-medium text-gray-900 fecha-salida-card">{{this.fecha_salida}}</div>
              </div>

              <div class="space-y-1">
                <div class="text-xs text-gray-500 font-medium inline-flex items-center gap-1">
                  <i class="fa-solid fa-credit-card text-indigo-600"></i>
                  Pago
                </div>
                <div class="text-sm font-medium text-gray-900 capitalize">{{this.tipo_pago}}</div>
              </div>

              <div class="space-y-1">
                <div class="text-xs text-gray-500 font-medium inline-flex items-center gap-1">
                  <i class="fa-solid fa-coins text-yellow-600"></i>
                  Monto
                </div>
                <div class="text-sm font-bold text-gray-900">${{this.monto}}</div>
              </div>
            </div>

            <!-- Estado de la renta -->
            <div class="pt-3 border-t border-gray-100">
              <div class="mb-2">
                <div class="text-xs text-gray-500 font-medium inline-flex items-center gap-1 mb-2">
                  <i class="fa-solid fa-clock"></i>
                  Estado de la renta
                </div>
                {{#if (eq this.estado_tiempo 'corriente')}}
                <div class="inline-flex items-center justify-between w-full px-3 py-2 bg-green-50 border border-green-100 rounded-lg">
                  <div class="flex items-center gap-2">
                    <i class="fa-solid fa-circle-check text-green-600"></i>
                    <div>
                      <div class="text-sm font-semibold text-green-800">Corriente</div>
                      <div class="text-xs text-green-600">{{this.tiempo_restante}}</div>
                    </div>
                  </div>
                  <span class="text-xs font-medium text-green-700 bg-green-100 px-2 py-1 rounded">
                    Activa
                  </span>
                </div>
                {{else}}
                <div class="inline-flex items-center justify-between w-full px-3 py-2 bg-red-50 border border-red-100 rounded-lg">
                  <div class="flex items-center gap-2">
                    <i class="fa-solid fa-triangle-exclamation text-red-600"></i>
                    <div>
                      <div class="text-sm font-semibold text-red-800">Expirada</div>
                      <div class="text-xs text-red-600">{{this.tiempo_restante}}</div>
                    </div>
                  </div>
                  <span class="text-xs font-medium text-red-700 bg-red-100 px-2 py-1 rounded">
                    Inactiva
                  </span>
                </div>
                {{/if}}
              </div>

              <!-- Monto en letras (solo en tablets) -->
              <div class="hidden sm:block mt-3">
                <div class="text-xs text-gray-500 font-medium inline-flex items-center gap-1 mb-1">
                  <i class="fa-regular fa-file-lines"></i>
                  Monto en letras
                </div>
                <div class="text-sm text-gray-700 bg-gray-50 p-2 rounded border border-gray-100">
                  {{this.monto_letras}}
                </div>
              </div>
            </div>

            <!-- Botones de acción -->
            <div class="pt-3 border-t border-gray-100">
              <div class="flex gap-2">
                {{#if (eq this.estado_tiempo 'corriente')}}
                <button type="button"
                  onclick="openDesocuparModal({{this.id_renta}}, '{{this.numero_habitacion}}', '{{this.nombre_cliente}}')"
                  class="flex-1 inline-flex items-center justify-center gap-2 px-4 py-2.5 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium shadow-sm transition-colors">
                  <i class="fa-solid fa-door-open"></i>
                  <span class="hidden sm:inline">Desocupar</span>
                  <span class="inline sm:hidden">Desocupar</span>
                </button>
                {{else}}
                <button type="button" disabled
                  class="flex-1 inline-flex items-center justify-center gap-2 px-4 py-2.5 bg-gray-300 text-gray-600 rounded-lg text-sm font-medium shadow-sm cursor-not-allowed">
                  <i class="fa-solid fa-ban"></i>
                  <span>Expirada</span>
                </button>
                {{/if}}

                {{#if (eq @root.user.role 'Administrador')}}
                <button type="button"
                  onclick="openDeleteModal({{this.id_renta}}, '{{this.numero_habitacion}}', '{{this.nombre_cliente}}')"
                  class="flex-1 inline-flex items-center justify-center gap-2 px-4 py-2.5 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm font-medium shadow-sm transition-colors">
                  <i class="fa-solid fa-trash-can"></i>
                  <span class="hidden sm:inline">Eliminar</span>
                  <span class="inline sm:hidden">Eliminar</span>
                </button>
                {{/if}}
              </div>
            </div>
          </div>
        </article>
        {{/each}}

        <!-- Mensaje de no resultados -->
        <div id="noResultsCard" class="hidden col-span-1 md:col-span-2 py-10 px-4 text-center text-gray-500">
          <div class="flex flex-col items-center">
            <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4">
              <i class="fas fa-search text-2xl text-gray-400"></i>
            </div>
            <h3 class="text-lg font-medium text-gray-700 mb-2">No se encontraron resultados</h3>
            <p class="text-sm text-gray-500 max-w-sm">No hay rentas que coincidan con tu búsqueda. Intenta con otros términos.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de confirmación de eliminación -->
  <div id="deleteModal" class="fixed inset-0 z-[9999] bg-black bg-opacity-50 hidden items-center justify-center px-4">
    <div class="bg-white rounded-lg shadow-2xl p-6 w-full max-w-sm sm:max-w-md transform transition-all">
      <div class="flex items-center justify-center w-12 h-12 mx-auto bg-red-100 rounded-full mb-4">
        <i class="fa-solid fa-triangle-exclamation text-red-600 text-2xl"></i>
      </div>
      <h2 class="text-lg sm:text-xl font-bold mb-2 text-gray-900 text-center">¿Eliminar renta?</h2>
      <p class="mb-6 text-gray-600 text-sm sm:text-base text-center">
        Estás a punto de eliminar la renta de la habitación <span id="deleteRoomNumber"
          class="font-bold text-blue-600"></span> para el cliente <span id="deleteClientName"
          class="font-bold text-gray-900"></span>.
      </p>
      <p class="mb-6 text-red-600 text-xs sm:text-sm text-center font-medium">
        <i class="fa-solid fa-circle-exclamation"></i> Esta acción no se puede deshacer.
      </p>
      <form id="deleteForm" method="POST" class="flex flex-col gap-3 w-full">
        <div class="flex flex-col sm:flex-row justify-end gap-2">
          <button type="button" onclick="closeDeleteModal()"
            class="px-4 py-2.5 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg font-semibold w-full sm:w-28 transition-colors">
            <i class="fa-solid fa-xmark"></i> Cancelar
          </button>
          <button type="submit"
            class="px-4 py-2.5 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold w-full sm:w-28 transition-colors">
            <i class="fa-solid fa-trash-can"></i> Eliminar
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal para desocupar renta -->
  <div id="desocuparModal"
    class="fixed inset-0 z-[9999] bg-black bg-opacity-50 hidden items-center justify-center px-4">
    <div class="bg-white rounded-lg shadow-2xl p-6 w-full max-w-sm sm:max-w-md transform transition-all">
      <div class="flex items-center justify-center w-12 h-12 mx-auto bg-green-100 rounded-full mb-4">
        <i class="fa-solid fa-door-open text-green-600 text-2xl"></i>
      </div>
      <h2 class="text-lg sm:text-xl font-bold mb-2 text-gray-900 text-center">¿Desocupar habitación?</h2>
      <p class="mb-4 text-gray-600 text-sm sm:text-base text-center">
        ¿Estás seguro de marcar como <span class="font-bold text-green-600">DESOCUPADA</span> la habitación <span
          id="desocuparRoomNumber" class="font-bold text-blue-600"></span>?
      </p>
      <div class="mb-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
        <p class="text-sm text-blue-800">
          <i class="fa-solid fa-user text-blue-600"></i> <strong>Cliente:</strong> <span id="desocuparClientName"
            class="font-medium"></span>
        </p>
      </div>
      <p class="mb-6 text-gray-600 text-xs sm:text-sm text-center">
        <i class="fa-solid fa-info-circle text-blue-500"></i> La renta se marcará como finalizada y la habitación pasará
        a
        estado <strong>"LIMPIEZA"</strong>. El registro se mantendrá para reportes.
      </p>
      <form id="desocuparForm" method="POST" class="flex flex-col gap-3 w-full">
        <div class="flex flex-col sm:flex-row justify-end gap-2">
          <button type="button" onclick="closeDesocuparModal()"
            class="px-4 py-2.5 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg font-semibold w-full sm:w-28 transition-colors">
            <i class="fa-solid fa-xmark"></i> Cancelar
          </button>
          <button type="submit"
            class="px-4 py-2.5 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold w-full sm:w-28 transition-colors">
            <i class="fa-solid fa-door-open"></i> Desocupar
          </button>
        </div>
      </form>
    </div>
  </div>

  {{else}}
  <div class="text-center py-16">
    <i class="fa-solid fa-file-invoice-dollar text-5xl text-slate-400"></i>
    <h2 class="mt-4 text-xl font-semibold text-slate-700">No se encontraron rentas</h2>
    <p class="mt-2 text-sm text-slate-500">Actualmente no hay rentas registradas.</p>
    <a href="/rooms"
      class="mt-6 inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg shadow-sm transition-colors">
      <i class="fa-solid fa-arrow-left"></i>
      <span>Volver a Habitaciones</span>
    </a>
  </div>
  {{/if}}

  <script>
    // Funciones para el modal de eliminación
    function openDeleteModal(rentId, roomNumber, clientName) {
      const modal = document.getElementById('deleteModal');
      const form = document.getElementById('deleteForm');
      const roomNumberSpan = document.getElementById('deleteRoomNumber');
      const clientNameSpan = document.getElementById('deleteClientName');

      if (modal && form) {
        form.action = `/rooms/rentas/delete/${rentId}`;
        roomNumberSpan.textContent = roomNumber;
        clientNameSpan.textContent = clientName;
        modal.classList.remove('hidden');
        modal.classList.add('flex');
      }
    }

    function closeDeleteModal() {
      const modal = document.getElementById('deleteModal');
      if (modal) {
        modal.classList.add('hidden');
        modal.classList.remove('flex');
      }
    }

    // Funciones para el modal de desocupar
    function openDesocuparModal(rentId, roomNumber, clientName) {
      const modal = document.getElementById('desocuparModal');
      const form = document.getElementById('desocuparForm');
      const roomNumberSpan = document.getElementById('desocuparRoomNumber');
      const clientNameSpan = document.getElementById('desocuparClientName');

      if (modal && form) {
        form.action = `/rooms/desocupar/${rentId}`;
        roomNumberSpan.textContent = roomNumber;
        clientNameSpan.textContent = clientName;
        modal.classList.remove('hidden');
        modal.classList.add('flex');
      }
    }

    function closeDesocuparModal() {
      const modal = document.getElementById('desocuparModal');
      if (modal) {
        modal.classList.add('hidden');
        modal.classList.remove('flex');
      }
    }

    // Cerrar modales al hacer clic fuera de ellos
    document.addEventListener('click', function (event) {
      const deleteModal = document.getElementById('deleteModal');
      const desocuparModal = document.getElementById('desocuparModal');

      if (deleteModal && event.target === deleteModal) {
        closeDeleteModal();
      }

      if (desocuparModal && event.target === desocuparModal) {
        closeDesocuparModal();
      }
    });

    // FUNCIÓN PARA AJUSTAR LA ALTURA DE LA TABLA DE RENTAS DINÁMICAMENTE
    function adjustRentasTableHeight() {
      const tableContainer = document.getElementById('rentasTableContainer');
      const rentasTableBody = document.getElementById('rentasTableBody');

      if (!tableContainer || !rentasTableBody) {
        console.log('Elementos de la tabla de rentas no encontrados');
        return;
      }

      const rentaRows = rentasTableBody.querySelectorAll('tr');
      const rentaCount = rentaRows.length;

      console.log(`Ajustando tabla de rentas: ${rentaCount} rentas encontradas`);

      // Si hay 4 o menos rentas, ajustar altura exacta sin espacio en blanco
      if (rentaCount <= 4) {
        console.log('Ajustando altura natural - sin scroll');
        // Altura automática basada en contenido, sin restricciones
        tableContainer.style.maxHeight = 'none';
        tableContainer.style.height = 'auto';
        tableContainer.style.overflowY = 'hidden';
        tableContainer.className = 'overflow-x-auto';
      } else {
        // Si hay más de 4 rentas, activar scroll con altura fija de 4 filas + header
        console.log('Con scroll - más de 4 rentas');
        // 4 filas (4 * 3.5rem) + Header (aprox 3.5rem)
        tableContainer.style.maxHeight = 'calc(4 * 3.5rem + 3.5rem)';
        tableContainer.style.height = '';
        tableContainer.style.overflowY = 'auto';
        tableContainer.className = 'overflow-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100';
      }
    }

    // Inicialización mejorada de filtros
    function initializeRentasFilters() {
      const overlay = document.getElementById('rentsLoadingOverlay');

      // Obtener todas las rentas (tabla y cards)
      const tableRows = Array.from(document.querySelectorAll('#tableSection .rent-reveal'));
      const cardElements = Array.from(document.querySelectorAll('#cardsSection .rent-reveal'));

      // Filtros
      const controls = {
        desktop: {
          q: document.getElementById('rentSearch'),
          reset: document.getElementById('rentReset'),
          count: document.getElementById('rentCount')
        },
        mobile: {
          q: document.getElementById('rentSearchMobile'),
          reset: document.getElementById('rentResetMobile'),
          count: document.getElementById('rentCountMobile')
        }
      };

      // Estado
      let currentSearch = '';
      let currentPage = 1;
      const itemsPerPage = 8; // Más items para cards

      // Controles de paginación
      const pagination = {
        desktop: {
          prev: document.getElementById('prevPageBtn'),
          next: document.getElementById('nextPageBtn'),
          indicator: document.getElementById('pageIndicator')
        },
        mobile: {
          prev: document.getElementById('prevPageBtnMobile'),
          next: document.getElementById('nextPageBtnMobile'),
          indicator: document.getElementById('pageIndicatorMobile')
        }
      };

      // Normalizar texto
      function norm(str) {
        return (str || '').toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
      }

      // Ocultar overlay
      setTimeout(() => {
        if (overlay) overlay.classList.add('hidden');

        // Animar elementos
        setTimeout(() => {
          document.querySelectorAll('.rent-reveal').forEach(el => {
            el.classList.remove('opacity-0', 'translate-y-1');
          });
        }, 100);
      }, 300);

      // Filtrar elementos
      function filterElements(elements, searchText) {
        if (!searchText) return elements;

        return elements.filter(el => {
          const searchLower = norm(searchText);
          const nombre = norm(el.dataset.nombre || '');
          const hab = norm(el.dataset.hab || '');
          const monto = norm(el.dataset.monto || '');
          const letras = norm(el.dataset.letras || '');
          const origen = norm(el.dataset.origen || '');
          const pago = norm(el.dataset.pago || '');

          return nombre.includes(searchLower) ||
                 hab.includes(searchLower) ||
                 monto.includes(searchLower) ||
                 letras.includes(searchLower) ||
                 origen.includes(searchLower) ||
                 pago.includes(searchLower);
        });
      }

      // Actualizar controles de paginación
      function updatePaginationControls(totalItems) {
        const totalPages = Math.ceil(totalItems / itemsPerPage) || 1;
        if (currentPage > totalPages) currentPage = 1;

        const indicatorText = `${currentPage}/${totalPages}`;

        // Desktop
        if (pagination.desktop.indicator) pagination.desktop.indicator.textContent = indicatorText;
        if (pagination.desktop.prev) pagination.desktop.prev.disabled = currentPage === 1;
        if (pagination.desktop.next) pagination.desktop.next.disabled = currentPage === totalPages;

        // Mobile
        if (pagination.mobile.indicator) pagination.mobile.indicator.textContent = indicatorText;
        if (pagination.mobile.prev) pagination.mobile.prev.disabled = currentPage === 1;
        if (pagination.mobile.next) pagination.mobile.next.disabled = currentPage === totalPages;
      }

      // Aplicar filtros
      function applyFilters() {
        const searchText = norm(currentSearch);

        // Filtrar ambas colecciones
        const filteredTableRows = filterElements(tableRows, searchText);
        const filteredCardElements = filterElements(cardElements, searchText);

        const totalFiltered = filteredTableRows.length;
        const totalPages = Math.ceil(totalFiltered / itemsPerPage) || 1;

        // Ajustar página actual si es necesario
        if (currentPage > totalPages) currentPage = 1;

        // Calcular índices para paginación
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;

        // Ocultar todos los elementos primero
        tableRows.forEach(row => {
          row.classList.add('hidden');
          row.style.display = 'none';
        });

        cardElements.forEach(card => {
          card.classList.add('hidden');
          card.style.display = 'none';
        });

        // Mostrar solo los elementos de la página actual
        const currentTableRows = filteredTableRows.slice(startIndex, endIndex);
        const currentCards = filteredCardElements.slice(startIndex, endIndex);

        currentTableRows.forEach(row => {
          row.classList.remove('hidden');
          row.style.display = '';
        });

        currentCards.forEach(card => {
          card.classList.remove('hidden');
          card.style.display = '';
        });

        // Actualizar contadores
        let summaryText = '0 rentas';
        if (totalFiltered > 0) {
          const first = startIndex + 1;
          const last = Math.min(endIndex, totalFiltered);
          summaryText = `${first}-${last} de ${totalFiltered}`;
        }

        if (controls.desktop.count) controls.desktop.count.textContent = summaryText;
        if (controls.mobile.count) controls.mobile.count.textContent = summaryText;

        // Actualizar controles de paginación
        updatePaginationControls(totalFiltered);

        // Mostrar/ocultar mensaje de no resultados
        const noResultsBody = document.getElementById('noResultsBody');
        const noResultsCard = document.getElementById('noResultsCard');

        if (totalFiltered === 0 && searchText) {
          if (noResultsBody) noResultsBody.classList.remove('hidden');
          if (noResultsCard) noResultsCard.classList.remove('hidden');
        } else {
          if (noResultsBody) noResultsBody.classList.add('hidden');
          if (noResultsCard) noResultsCard.classList.add('hidden');
        }

        // Ajustar altura de la tabla
        setTimeout(() => {
          adjustRentasTableHeight();
        }, 50);
      }

      // Cambiar de página
      function changePage(delta) {
        const totalFiltered = filterElements(tableRows, norm(currentSearch)).length;
        const totalPages = Math.ceil(totalFiltered / itemsPerPage) || 1;
        const newPage = currentPage + delta;

        if (newPage >= 1 && newPage <= totalPages) {
          currentPage = newPage;
          applyFilters();
        }
      }

      // Sincronizar inputs de búsqueda
      function syncSearchInputs(value) {
        if (controls.desktop.q) controls.desktop.q.value = value;
        if (controls.mobile.q) controls.mobile.q.value = value;
      }

      // Manejar búsqueda
      function handleSearchInput(event) {
        currentSearch = event.target.value;
        currentPage = 1;
        syncSearchInputs(currentSearch);
        applyFilters();
      }

      // Resetear filtros
      function handleResetClick() {
        currentSearch = '';
        currentPage = 1;
        syncSearchInputs('');
        applyFilters();
      }

      // Configurar event listeners
      if (controls.desktop.q) {
        controls.desktop.q.addEventListener('input', handleSearchInput);
      }

      if (controls.mobile.q) {
        controls.mobile.q.addEventListener('input', handleSearchInput);
      }

      if (controls.desktop.reset) {
        controls.desktop.reset.addEventListener('click', handleResetClick);
      }

      if (controls.mobile.reset) {
        controls.mobile.reset.addEventListener('click', handleResetClick);
      }

      // Paginación
      if (pagination.desktop.prev) {
        pagination.desktop.prev.addEventListener('click', () => changePage(-1));
      }

      if (pagination.desktop.next) {
        pagination.desktop.next.addEventListener('click', () => changePage(1));
      }

      if (pagination.mobile.prev) {
        pagination.mobile.prev.addEventListener('click', () => changePage(-1));
      }

      if (pagination.mobile.next) {
        pagination.mobile.next.addEventListener('click', () => changePage(1));
      }

      // Inicializar
      currentSearch = controls.desktop.q?.value || controls.mobile.q?.value || '';
      applyFilters();
    }

    // Inicializar al cargar la página
    document.addEventListener('DOMContentLoaded', function() {
      adjustRentasTableHeight();
      initializeRentasFilters();

      // Añadir scroll suave para cards
      const cardsSection = document.getElementById('cardsSection');
      if (cardsSection) {
        cardsSection.style.scrollBehavior = 'smooth';
      }
    });

    // Ajustar en resize
    window.addEventListener('resize', function() {
      setTimeout(() => {
        adjustRentasTableHeight();
      }, 100);
    });
  </script>
