<div class="min-h-screen flex items-center justify-center p-4 bg-gray-50">
  <div class="w-full sm:max-w-sm md:max-w-md lg:max-w-lg bg-white p-6 rounded-xl shadow-lg space-y-6">
    
    <div class="text-center">
      <h2 class="text-2xl font-bold text-gray-900 mb-2">Recuperar Contraseña</h2>
      <p class="text-gray-600">Ingresa tu correo electrónico para recibir un código de recuperación</p>
    </div>

    {{#unless showCodeForm}}
    <!-- Formulario para ingresar email -->
    <form action="/password-reset/request" method="POST" class="space-y-4">
      <div>
        <label for="email" class="block text-gray-700 font-medium mb-2">Correo electrónico:</label>
        <input type="email" id="email" name="email" required
               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
               placeholder="ejemplo@correo.com">
      </div>

      <button type="submit"
              class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition duration-200 font-medium">
        Enviar código de recuperación
      </button>
    </form>
    {{/unless}}

    {{#if showCodeForm}}
    <!-- Formulario para ingresar código -->
    <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
      <p class="text-green-800 text-sm">
        <strong>✓ Código enviado</strong><br>
        Revisa tu correo electrónico e ingresa el código de 6 dígitos que recibiste.
      </p>
    </div>

    <form action="/password-reset/verify-code" method="POST" class="space-y-4">
      <input type="hidden" name="email" value="{{email}}">
      
      <div>
        <label for="code" class="block text-gray-700 font-medium mb-2">Código de verificación:</label>
        <input type="text" id="code" name="code" required maxlength="6" 
               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-center text-2xl font-mono letter-spacing-wide"
               placeholder="123456"
               pattern="[0-9]{6}"
               title="Ingresa el código de 6 dígitos">
      </div>

      <button type="submit"
              class="w-full bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition duration-200 font-medium">
        Verificar código
      </button>
    </form>

    <div class="text-center">
      <a href="/password-reset/request" class="text-blue-600 hover:text-blue-800 text-sm">
        ← Solicitar nuevo código
      </a>
    </div>
    {{/if}}

    <!-- Mensajes de error y éxito -->
    {{#if error}}
      <div class="bg-red-50 border border-red-200 rounded-lg p-4">
        <p class="text-red-800 text-sm">❌ {{error}}</p>
      </div>
    {{/if}}

    {{#if success}}
      <div class="bg-green-50 border border-green-200 rounded-lg p-4">
        <p class="text-green-800 text-sm">✅ {{success}}</p>
      </div>
    {{/if}}

    <!-- Enlace para volver al login -->
    <div class="text-center pt-4 border-t border-gray-200">
      <a href="/login" class="text-gray-600 hover:text-gray-800 text-sm">
        ← Volver al inicio de sesión
      </a>
    </div>

  </div>
</div>

<style>
.letter-spacing-wide {
  letter-spacing: 0.5em;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const codeInput = document.getElementById('code');
  if (codeInput) {
    // Auto-formato del código (solo números)
    codeInput.addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, ''); // Solo números
      if (value.length > 6) value = value.slice(0, 6); // Máximo 6 dígitos
      e.target.value = value;
    });

    // Auto-submit cuando se completen 6 dígitos
    codeInput.addEventListener('input', function(e) {
      if (e.target.value.length === 6) {
        // Pequeña pausa para que el usuario vea el código completo
        setTimeout(() => {
          e.target.closest('form').submit();
        }, 500);
      }
    });
  }
});
</script>
