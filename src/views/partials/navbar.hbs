<header
  class="fixed top-0 left-0 w-full z-50 bg-gradient-to-r from-blue-800 to-blue-700 text-white shadow-md border-b border-blue-700/40 backdrop-saturate-150"
>
  <!-- iOS safe-area filler to prevent white stripe at the notch/status bar -->
  <div
    class="md:hidden"
    style="height: env(safe-area-inset-top); background: #1e40af;"
  ></div>
  <div
    class="max-w-7xl mx-auto flex items-center justify-between p-2.5 sm:p-3 lg:p-3 min-h-[48px] sm:min-h-[54px]"
  >
    <!-- Logo -->
    <a
      href="/home"
      class="inline-flex items-center justify-center gap-1.5 text-2xl md:text-3xl font-bold leading-tight tracking-tight hover:text-blue-200 transition"
      aria-label="Inicio"
      title="Inicio"
      style="min-width:2.5rem;"
    >
      <i class="fa-solid fa-hotel text-yellow-300 drop-shadow-lg" style="font-size:2rem;"></i>
    </a>
    <!-- Enlaces desktop -->
    <nav aria-label="Principal" class="hidden md:block">
      <ul
        class="flex items-center gap-3 md:gap-4 lg:gap-6 flex-nowrap whitespace-nowrap overflow-hidden"
      >
        {{#if (eq user.role "Administrador")}}
          <li class="relative group">
            <a
              href="/admin"
              class="group inline-flex items-center justify-center px-2 py-2 rounded hover:bg-white/10 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/60 transition"
              title="Panel de Administraci√≥n"
            >
              <i class="fa-solid fa-sliders fa-lg text-purple-400 group-hover:text-purple-200 transition"></i>
            </a>
            <span class="navbar-tooltip">
              <span class="font-bold text-purple-300 text-sm">Panel de Administraci√≥n</span>
            </span>
          </li>
        {{/if}}
        <li class="relative group">
          <a
            href="/entries"
            class="group inline-flex items-center justify-center px-2 py-2 rounded hover:bg-white/10 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/60 transition"
            title="Entradas"
          >
            <i class="fa-solid fa-door-open fa-lg text-blue-200 group-hover:text-blue-100 transition"></i>
          </a>
          <span class="navbar-tooltip">
            <span class="font-bold text-blue-200 text-sm">Entradas</span>
          </span>
        </li>
        <li class="relative group">
          <a
            href="/rooms"
            class="group inline-flex items-center justify-center px-2 py-2 rounded hover:bg-white/10 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/60 transition"
            title="Habitaciones"
          >
            <i class="fa-solid fa-bed fa-lg text-cyan-300 group-hover:text-cyan-100 transition"></i>
          </a>
          <span class="navbar-tooltip">
            <span class="font-bold text-cyan-200 text-sm">Habitaciones</span>
          </span>
        </li>
        <li class="relative group">
          <a
            href="/memberships"
            class="group inline-flex items-center justify-center px-2 py-2 rounded hover:bg-white/10 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/60 transition"
            title="Membres√≠as"
          >
            <i class="fa-solid fa-id-card fa-lg text-yellow-300 group-hover:text-yellow-100 transition"></i>
          </a>
          <span class="navbar-tooltip">
            <span class="font-bold text-yellow-200 text-sm">Membres√≠as</span>
          </span>
        </li>
        <li class="relative group">
          <a
            href="/store"
            class="group inline-flex items-center justify-center px-2 py-2 rounded hover:bg-white/10 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/60 transition"
            title="Tienda"
          >
            <i class="fa-solid fa-store fa-lg text-green-300 group-hover:text-green-100 transition"></i>
          </a>
          <span class="navbar-tooltip">
            <span class="font-bold text-green-200 text-sm">Tienda</span>
          </span>
        </li>
        <li class="relative group">
          <a
            href="/logout"
            class="group inline-flex items-center justify-center px-2 py-2 rounded hover:bg-white/10 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/60 transition"
            title="Cerrar Sesi√≥n"
          >
            <i class="fa-solid fa-right-from-bracket fa-lg text-red-400 group-hover:text-red-200 transition"></i>
          </a>
          <span class="navbar-tooltip">
            <span class="font-bold text-red-300 text-sm">Cerrar Sesi√≥n</span>
          </span>
        </li>
      </ul>
    </nav>

    <!-- Bot√≥n hamburguesa m√≥vil -->
    <button
      id="btn-open-sidebar"
      class="md:hidden focus:outline-none p-2 rounded hover:bg-white/10 active:scale-[0.98] transition"
      aria-label="Abrir men√∫"
      aria-controls="sidebar"
      aria-expanded="false"
    >
      <svg
        class="w-6 h-6 sm:w-7 sm:h-7 transition-transform duration-200 hover:rotate-6"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M4 6h16M4 12h16M4 18h16"
        />
      </svg>
    </button>
  </div>

  <!-- Sidebar m√≥vil -->
  <div
    id="sidebar"
    class="fixed top-0 left-0 w-64 max-w-[80vw] bg-blue-700 shadow-xl transform -translate-x-full transition-transform duration-200 ease-out z-[60] flex flex-col"
    role="dialog"
    aria-modal="true"
    aria-hidden="true"
    style="height: 100dvh; padding-top: env(safe-area-inset-top); padding-bottom: env(safe-area-inset-bottom);"
  >
    <div
      class="flex justify-between items-center p-4 border-b border-blue-600/60 sticky top-0 bg-blue-700"
      style="margin-top: calc(-1 * env(safe-area-inset-top)); padding-top: calc(env(safe-area-inset-top) + 1rem);"
    >
      <span class="font-bold text-white">Men√∫</span>
      <button
        id="btn-close-sidebar"
        class="text-white focus:outline-none hover:text-green-200 p-2 rounded"
        aria-label="Cerrar men√∫"
      >&times;</button>
    </div>
    <ul
      class="flex-1 flex flex-col space-y-2 p-3 bg-blue-700 text-white overflow-y-auto"
    >
      {{#if (eq user.role "Administrador")}}
        <li>
          <a
            href="/admin"
            class="group flex items-center gap-2 px-3 py-3 rounded hover:bg-white/10 text-white transition"
            title="Panel de Administraci√≥n"
          >
            <i class="fa-solid fa-sliders fa-xl text-purple-300 group-hover:text-purple-100 transition"></i>
            <span class="text-base font-medium">Panel</span>
          </a>
        </li>
      {{/if}}
      <li>
        <a
          href="/entries"
          class="group flex items-center gap-2 px-3 py-3 rounded hover:bg-white/10 text-white transition"
          title="Entradas"
        >
          <i class="fa-solid fa-door-open fa-xl text-blue-200 group-hover:text-blue-100 transition"></i>
          <span class="text-base font-medium">Entradas</span>
        </a>
      </li>
      <li>
        <a
          href="/rooms"
          class="group flex items-center gap-2 px-3 py-3 rounded hover:bg-white/10 text-white transition"
          title="Habitaciones"
        >
          <i class="fa-solid fa-bed fa-xl text-cyan-200 group-hover:text-cyan-100 transition"></i>
          <span class="text-base font-medium">Habitaciones</span>
        </a>
      </li>
      <li>
        <a
          href="/memberships"
          class="group flex items-center gap-2 px-3 py-3 rounded hover:bg-white/10 text-white transition"
          title="Membres√≠as"
        >
          <i class="fa-solid fa-id-card fa-xl text-yellow-200 group-hover:text-yellow-100 transition"></i>
          <span class="text-base font-medium">Membres√≠as</span>
        </a>
      </li>
      <li>
        <a
          href="/store"
          class="group flex items-center gap-2 px-3 py-3 rounded hover:bg-white/10 text-white transition"
          title="Tienda"
        >
          <i class="fa-solid fa-store fa-xl text-green-200 group-hover:text-green-100 transition"></i>
          <span class="text-base font-medium">Tienda</span>
        </a>
      </li>
      <li>
        <a
          href="/logout"
          class="group flex items-center gap-2 px-3 py-3 rounded hover:bg-white/10 text-white transition"
          title="Cerrar Sesi√≥n"
        >
          <i class="fa-solid fa-right-from-bracket fa-xl text-red-300 group-hover:text-red-100 transition"></i>
          <span class="text-base font-medium">Salir</span>
        </a>
      </li>
    </ul>
  </div>

  <!-- Overlay semitransparente -->
  <div
    id="overlay"
    class="fixed inset-0 bg-black/50 hidden z-[55] md:hidden"
  ></div>
</header>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const btnOpen = document.getElementById('btn-open-sidebar');
  const btnClose = document.getElementById('btn-close-sidebar');
  const sidebar = document.getElementById('sidebar');
  const overlay = document.getElementById('overlay');
  const focusableSelectors = 'a, button, input, select, textarea, [tabindex]';
  let lastFocused = null;

  // Debug: Verificar que los elementos existen
  console.log('Navbar Debug:', {
    btnOpen: !!btnOpen,
    btnClose: !!btnClose,
    sidebar: !!sidebar,
    overlay: !!overlay
  });

  // Set mobile browser bar color to match navbar (blue-800)
  (function setThemeColor() {
    const NAV_BLUE = '#1e40af';
    let meta = document.querySelector('meta[name="theme-color"]');
    if (!meta) {
      meta = document.createElement('meta');
      meta.setAttribute('name', 'theme-color');
      document.head.appendChild(meta);
    }
    meta.setAttribute('content', NAV_BLUE);

    // Also set platform-specific meta where possible
    let ms = document.querySelector('meta[name="msapplication-navbutton-color"]');
    if (!ms) {
      ms = document.createElement('meta');
      ms.setAttribute('name', 'msapplication-navbutton-color');
      document.head.appendChild(ms);
    }
    ms.setAttribute('content', NAV_BLUE);

    let appleCap = document.querySelector('meta[name="apple-mobile-web-app-capable"]');
    if (!appleCap) {
      appleCap = document.createElement('meta');
      appleCap.setAttribute('name', 'apple-mobile-web-app-capable');
      document.head.appendChild(appleCap);
    }
    appleCap.setAttribute('content', 'yes');

    let appleStyle = document.querySelector('meta[name="apple-mobile-web-app-status-bar-style"]');
    if (!appleStyle) {
      appleStyle = document.createElement('meta');
      appleStyle.setAttribute('name', 'apple-mobile-web-app-status-bar-style');
      document.head.appendChild(appleStyle);
    }
    appleStyle.setAttribute('content', 'black-translucent');

    // Optional: keep it updated if system theme changes
    const mql = window.matchMedia('(prefers-color-scheme: dark)');
    if (mql && typeof mql.addEventListener === 'function') {
      mql.addEventListener('change', () => meta.setAttribute('content', NAV_BLUE));
    }
  })();

  const openSidebar = () => {
    console.log('üîµ Abriendo sidebar...');
    lastFocused = document.activeElement;
    sidebar.classList.remove('-translate-x-full');
    sidebar.setAttribute('aria-hidden', 'false');
    btnOpen.setAttribute('aria-expanded', 'true');
    overlay.classList.remove('hidden');
    // prevent body scroll
    document.body.style.overflow = 'hidden';
    // focus first link
    const first = sidebar.querySelector(focusableSelectors);
    if (first) first.focus();
    console.log('‚úÖ Sidebar abierto');
  };

  const closeSidebar = () => {
    sidebar.classList.add('-translate-x-full');
    sidebar.setAttribute('aria-hidden', 'true');
    btnOpen.setAttribute('aria-expanded', 'false');
    overlay.classList.add('hidden');
    document.body.style.overflow = '';
    if (lastFocused) lastFocused.focus();
  };

  // Verificar que los elementos existen antes de agregar event listeners
  if (btnOpen) {
    btnOpen.addEventListener('click', openSidebar);
    console.log('‚úÖ Event listener agregado al bot√≥n hamburguesa');
  } else {
    console.error('‚ùå No se encontr√≥ el bot√≥n hamburguesa (btn-open-sidebar)');
  }
  if (btnClose) {
    btnClose.addEventListener('click', closeSidebar);
  } else {
    console.error('‚ùå No se encontr√≥ el bot√≥n de cerrar (btn-close-sidebar)');
  }
  if (overlay) {
    overlay.addEventListener('click', closeSidebar);
  } else {
    console.error('‚ùå No se encontr√≥ el overlay');
  }

  // Close on Escape
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && !sidebar.classList.contains('-translate-x-full')) {
      closeSidebar();
    }
  });

  // Cerrar sidebar si cambia a desktop
  window.addEventListener('resize', () => {
    if (window.innerWidth >= 768) {
      closeSidebar();
    }
  });

  // Cerrar sidebar al hacer click en cualquier enlace
  document.querySelectorAll('#sidebar a').forEach(a => {
    a.addEventListener('click', () => {
      if (window.innerWidth < 768) closeSidebar();
    });
  });
});
</script>

<style>
/* ...existing code... */
.navbar-tooltip {
  position: absolute;
  left: 50%;
  top: 100%;
  transform: translateX(-50%);
  margin-top: 0.5rem;
  padding: 0.35rem 1rem;
  border-radius: 0.5rem;
  background: #1e293b;
  color: #fff;
  font-size: 0.95rem;
  font-weight: 600;
  box-shadow: 0 4px 16px 0 rgba(0,0,0,0.18);
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  white-space: nowrap;
  z-index: 100;
  transition: opacity 0.18s, visibility 0.18s, transform 0.18s;
  border: 2px solid #334155;
  letter-spacing: 0.02em;
  text-shadow: 0 1px 2px #0005;
}
.group:hover .navbar-tooltip,
.group:focus-within .navbar-tooltip {
  opacity: 1;
  visibility: visible;
  transform: translateX(-50%) translateY(0.25rem) scale(1.04);
}
</style>
